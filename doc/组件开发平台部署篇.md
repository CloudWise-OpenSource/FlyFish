# 组件开发平台部署篇

> visual_component_platform_web、visual_component_platform 部署流程

### 一、前端源码打包部署

> visual_component_platform_web 应用平台前端源码，flyfish 采用的是前后端分离开发混合部署的模式，前端 build 后的部署包放在对应的 visual_component_platform 应用平台后端 www/static/visual_component_platform 下即可。

1. 项目内使用 code-server

```bash
# 修改 codeServerUrl 地址为组件所在目录地址，注意：修改截图红框内前缀即可：
vim /data/fly-fish-2.0/visual_component_platform_web/src/routes/dataVisualComponents/components/ComponentCreate/CodeEditor.jsx

```

<img src="./images/pic_1.jpg" width='600' >

2. 前端打包

```bash
# 进入应用平台前端源码目录
cd visual_component_platform_web

# 安装依赖
npm install

# 打包
npm run build

# 终端输出打包成功！
# 在 visual_component_platform_web 目录下生成 release 部署包内包含 platform、index.html
# 将 release 中的静态资源放入 visual_component_platform 应用平台后端 www/static/visual_component_platform 下即可

```

**⚠️ 注意！**

应用平台后端 www/static/visual_component_platform 下已有前端部署包，将新打包的部署包替换旧包即可，如嫌麻烦也可直接使用旧前端包。

### 二、组件开发平台前后端部署

> flyfish 后端集成多种运行模式，production、development、staging 等，其实每种模式对于用户来说并无差别，只是为了方便开发人员开发，文档默认使用 development 模式，对应只修改 development 配置即可。

#### 组件开发平台后端部署

1. 进入 visual_component_platform 项目

```bash
# 进入应用平台后端源码目录
cd visual_component_platform

# 安装应用平台后端依赖
npm install

```

2. 修改初始化数据库配置

```bash
# 编辑文件
vim config/database.dev.json

# 修改IP（host）、修改数据库用户名（user）、修改数据库密码（password）
{
  "mysql": {
    "driver": "mysql",
    "host": "10.2.3.153",
    "user": "Rootmaster",
    "password": "Rootmaster@777",
    "database": "visual_component_platform"
  }
}

```

3. 编辑 src/common/config/config.js

```bash
# 编辑文件
vim src/common/config/config.js

# port默认8363（不建议修改）、服务 worker 进程
port: "8363",
host: '主机ip',
workers: 0,

```

4. 编辑 src/common/config/adapter.js

```bash
# 编辑文件
vim src/common/config/adapter.js

# 配置redis
exports.cache = {
  redis: {
    port: "6379",
    host: 'redis主机ip',
    password: ''
  }
};

# 配置MySQL
exports.model = {
  mysql: {
    database: 'visual_component_platform',
    user: '数据库用户',
    password: '数据库密码',
    host: '数据库主机IP',
    port: '数据库端口',
  }
};

```

#### 组件开发平台前端配置文件修改

1. 编辑可视化平台配置文件

```bash
# 编辑文件
vim www/static/visual_component_platform/config/ENV.js

var rootPath = '/pw/';     // 路由的根路径
var apiDomain = 'http://ip:8363';    // api请求接口

```

2. 编辑平台入口配置文件

```bash
# 编辑文件
vim www/static/visual_component_platform/config/ENV.js

platformClassify: [
    {
      label: '组件开发平台',
      url: 'http://${服务器ip}:8363',
    },
    {
      label: '数据应用平台',
      url: 'http://${服务器ip}:8362',
    }
]
```


#### 启动项目

1. 创建数据库

```sheLL
# 执行 sql 创建数据库
CREATE DATABASE IF NOT EXISTS visual_component_platform DEFAULT CHARSET utf8 COLLATE utf8_general_ci;

# 初始化表
npm run init_database_dev

# 启动应用
pm2 start dev.js -n 'flyfish_visual_component_platform'

```
<img src="./images/flyfish_visual_component_platform.png" width='900' >

#### FAQ：

如果项目依赖安装失败，推荐您使用删除 node_modules，使用 cnpm、yarn、pnpm 等包管理器重新安装依赖。

