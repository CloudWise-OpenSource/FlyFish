{"version":3,"sources":["out-vscode/vs/workbench/contrib/webview/browser/pre/host.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n// @ts-check\n\nimport { createWebviewManager } from './main.js';\n\nconst id = document.location.search.match(/\\bid=([\\w-]+)/)[1];\nconst onElectron = /platform=electron/.test(document.location.search);\n\nconst hostMessaging = new class HostMessaging {\n\tconstructor() {\n\t\t/** @type {Map<string, Array<(event: MessageEvent, data: any) => void>>} */\n\t\tthis.handlers = new Map();\n\n\t\twindow.addEventListener('message', (e) => {\n\t\t\tconst channel = e.data.channel;\n\t\t\tconst handlers = this.handlers.get(channel);\n\t\t\tif (handlers) {\n\t\t\t\tfor (const handler of handlers) {\n\t\t\t\t\thandler(e, e.data.args);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('no handler for ', e);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * @param {string} channel\n\t * @param {any} data\n\t */\n\tpostMessage(channel, data) {\n\t\twindow.parent.postMessage({ target: id, channel, data }, '*');\n\t}\n\n\t/**\n\t * @param {string} channel\n\t * @param {(event: MessageEvent, data: any) => void} handler\n\t */\n\tonMessage(channel, handler) {\n\t\tlet handlers = this.handlers.get(channel);\n\t\tif (!handlers) {\n\t\t\thandlers = [];\n\t\t\tthis.handlers.set(channel, handlers);\n\t\t}\n\t\thandlers.push(handler);\n\t}\n}();\n\nconst unloadMonitor = new class {\n\n\tconstructor() {\n\t\tthis.confirmBeforeClose = 'keyboardOnly';\n\t\tthis.isModifierKeyDown = false;\n\n\t\thostMessaging.onMessage('set-confirm-before-close', (_e, /** @type {string} */ data) => {\n\t\t\tthis.confirmBeforeClose = data;\n\t\t});\n\n\t\thostMessaging.onMessage('content', (_e, /** @type {any} */ data) => {\n\t\t\tthis.confirmBeforeClose = data.confirmBeforeClose;\n\t\t});\n\n\t\twindow.addEventListener('beforeunload', (event) => {\n\t\t\tif (onElectron) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (this.confirmBeforeClose) {\n\t\t\t\tcase 'always':\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.returnValue = '';\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\tcase 'never':\n\t\t\t\t\t{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'keyboardOnly':\n\t\t\t\tdefault: {\n\t\t\t\t\tif (this.isModifierKeyDown) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.returnValue = '';\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonIframeLoaded(/** @type {HTMLIFrameElement} */frame) {\n\t\tframe.contentWindow.addEventListener('keydown', e => {\n\t\t\tthis.isModifierKeyDown = e.metaKey || e.ctrlKey || e.altKey;\n\t\t});\n\n\t\tframe.contentWindow.addEventListener('keyup', () => {\n\t\t\tthis.isModifierKeyDown = false;\n\t\t});\n\t}\n};\n\ncreateWebviewManager({\n\tpostMessage: hostMessaging.postMessage.bind(hostMessaging),\n\tonMessage: hostMessaging.onMessage.bind(hostMessaging),\n\tonElectron: onElectron,\n\tuseParentPostMessage: false,\n\tonIframeLoaded: (frame) => {\n\t\tunloadMonitor.onIframeLoaded(frame);\n\t}\n});\n"],"mappings":"AAMA,iDAEA,KAAM,GAAK,SAAS,SAAS,OAAO,MAAM,iBAAiB,GACrD,EAAa,oBAAoB,KAAK,SAAS,SAAS,QAExD,EAAgB,GAAI,OACzB,cAEC,KAAK,SAAW,GAAI,KAEpB,OAAO,iBAAiB,UAAW,AAAC,IACnC,KAAM,GAAU,EAAE,KAAK,QACjB,EAAW,KAAK,SAAS,IAAI,GACnC,GAAI,EACH,SAAW,KAAW,GACrB,EAAQ,EAAG,EAAE,KAAK,UAGnB,SAAQ,IAAI,kBAAmB,KASlC,YAAY,EAAS,GACpB,OAAO,OAAO,YAAY,CAAE,OAAQ,EAAI,UAAS,QAAQ,KAO1D,UAAU,EAAS,GAClB,GAAI,GAAW,KAAK,SAAS,IAAI,GACjC,AAAK,GACJ,GAAW,GACX,KAAK,SAAS,IAAI,EAAS,IAE5B,EAAS,KAAK,KAIV,EAAgB,GAAI,OAEzB,cACC,KAAK,mBAAqB,eAC1B,KAAK,kBAAoB,GAEzB,EAAc,UAAU,2BAA4B,CAAC,EAA0B,KAC9E,KAAK,mBAAqB,IAG3B,EAAc,UAAU,UAAW,CAAC,EAAuB,KAC1D,KAAK,mBAAqB,EAAK,qBAGhC,OAAO,iBAAiB,eAAgB,AAAC,IACxC,GAAI,GAIJ,OAAQ,KAAK,wBACP,SAEH,SAAM,iBACN,EAAM,YAAc,GACb,OAEJ,QAEH,UAEG,wBAEJ,GAAI,KAAK,kBACR,SAAM,iBACN,EAAM,YAAc,GACb,GAER,UAMJ,eAA+C,GAC9C,EAAM,cAAc,iBAAiB,UAAW,IAC/C,KAAK,kBAAoB,EAAE,SAAW,EAAE,SAAW,EAAE,SAGtD,EAAM,cAAc,iBAAiB,QAAS,KAC7C,KAAK,kBAAoB,OAK5B,EAAqB,CACpB,YAAa,EAAc,YAAY,KAAK,GAC5C,UAAW,EAAc,UAAU,KAAK,GACxC,WAAY,EACZ,qBAAsB,GACtB,eAAgB,AAAC,IAChB,EAAc,eAAe","names":[],"file":"host.js"}