/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/(function(){var T=["vs/server/node/util","require","exports","vs/base/common/uriIpc","vs/code/browser/workbench/workbench","vs/workbench/workbench.web.api","vs/base/common/uri","vs/base/common/event","vs/base/common/uuid","vs/base/common/cancellation","vs/base/common/buffer","vs/base/common/lifecycle","vs/base/parts/request/browser/request","vs/platform/windows/common/windows","vs/base/common/resources","vs/base/browser/browser","vs/nls!vs/code/browser/workbench/workbench","vs/base/common/network","vs/platform/product/common/product"],Y=function(g){for(var s=[],u=0,d=g.length;u<d;u++)s[u]=T[g[u]];return s};define(T[0],Y([1,2,3]),function(g,s,u){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.encodePath=s.getUriTransformer=void 0;const d=h=>new u.URITransformer(h);s.getUriTransformer=d;const U=h=>h.split("/").map(v=>encodeURIComponent(v)).join("/");s.encodePath=U}),define(T[4],Y([1,2,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0]),function(g,s,u,d,U,h,v,q,M,_,a,I,C,S,b,$,P){"use strict";Object.defineProperty(s,"__esModule",{value:!0});function O(f,e){let t;if(e){let r=0;e.forEach((o,l)=>{t||(t=""),t+=`${r++==0?"":"&"}${l}=${encodeURIComponent(o)}`})}return d.URI.parse(window.location.href).with({path:f,query:t})}class m{constructor(){let e;const t=document.getElementById("vscode-workbench-auth-session"),r=t?t.getAttribute("data-settings"):void 0;if(r)try{e=JSON.parse(r)}catch(o){}e&&(this.setPassword(`${$.default.urlProtocol}.login`,"account",JSON.stringify(e)),this.authService=`${$.default.urlProtocol}-${e.providerId}.login`,this.setPassword(this.authService,"account",JSON.stringify(e.scopes.map(o=>({id:e.id,scopes:o,accessToken:e.accessToken})))))}get credentials(){if(!this._credentials){try{const e=window.localStorage.getItem(m.CREDENTIALS_OPENED_KEY);e&&(this._credentials=JSON.parse(e))}catch(e){}Array.isArray(this._credentials)||(this._credentials=[])}return this._credentials}save(){window.localStorage.setItem(m.CREDENTIALS_OPENED_KEY,JSON.stringify(this.credentials))}async getPassword(e,t){return this.doGetPassword(e,t)}async doGetPassword(e,t){for(const r of this.credentials)if(r.service===e&&(typeof t!="string"||t===r.account))return r.password;return null}async setPassword(e,t,r){this.doDeletePassword(e,t),this.credentials.push({service:e,account:t,password:r}),this.save();try{if(r&&e===this.authService){const o=JSON.parse(r);Array.isArray(o)&&o.length===0&&await this.logout(e)}}catch(o){console.log(o)}}async deletePassword(e,t){const r=await this.doDeletePassword(e,t);if(r&&e===this.authService)try{await this.logout(e)}catch(o){console.log(o)}return r}async doDeletePassword(e,t){let r=!1;return this._credentials=this.credentials.filter(o=>o.service===e&&o.account===t?(r=!0,!1):!0),r&&this.save(),r}async findPassword(e){return this.doGetPassword(e)}async findCredentials(e){return this.credentials.filter(t=>t.service===e).map(({account:t,password:r})=>({account:t,password:r}))}async logout(e){const t=new Map;t.set("logout",String(!0)),t.set("service",e),await(0,_.request)({url:O("/auth/logout",t).toString(!0)},v.CancellationToken.None)}}m.CREDENTIALS_OPENED_KEY="credentials.provider";class n extends M.Disposable{constructor(){super(...arguments);this._onCallback=this._register(new U.Emitter),this.onCallback=this._onCallback.event}create(e){const t=new Map,r=(0,h.generateUuid)();t.set(n.QUERY_KEYS.REQUEST_ID,r);const{scheme:o,authority:l,path:i,query:R,fragment:E}=e||{scheme:void 0,authority:void 0,path:void 0,query:void 0,fragment:void 0};return o&&t.set(n.QUERY_KEYS.SCHEME,o),l&&t.set(n.QUERY_KEYS.AUTHORITY,l),i&&t.set(n.QUERY_KEYS.PATH,i),R&&t.set(n.QUERY_KEYS.QUERY,R),E&&t.set(n.QUERY_KEYS.FRAGMENT,E),this.periodicFetchCallback(r,Date.now()),O("/callback",t)}async periodicFetchCallback(e,t){const r=new Map;r.set(n.QUERY_KEYS.REQUEST_ID,e);const o=await(0,_.request)({url:O("/fetch-callback",r).toString(!0)},v.CancellationToken.None),l=await(0,q.streamToBuffer)(o.stream);if(l.byteLength>0){try{this._onCallback.fire(d.URI.revive(JSON.parse(l.toString())))}catch(i){console.error(i)}return}Date.now()-t<n.FETCH_TIMEOUT&&setTimeout(()=>this.periodicFetchCallback(e,t),n.FETCH_INTERVAL)}}n.FETCH_INTERVAL=500,n.FETCH_TIMEOUT=5*60*1e3,n.QUERY_KEYS={REQUEST_ID:"vscode-requestId",SCHEME:"vscode-scheme",AUTHORITY:"vscode-authority",PATH:"vscode-path",QUERY:"vscode-query",FRAGMENT:"vscode-fragment"};class c{constructor(e,t){this.workspace=e,this.payload=t,this.trusted=!0}async open(e,t){if((t==null?void 0:t.reuse)&&!t.payload&&this.isSame(this.workspace,e))return!0;const r=this.createTargetUrl(e,t);if(r){if(t==null?void 0:t.reuse)return window.location.href=r,!0;{let o;return C.isStandalone?o=window.open(r,"_blank","toolbar=no"):o=window.open(r),!!o}}return!1}createTargetUrl(e,t){let r;if(!e)r=`${document.location.origin}${document.location.pathname}?${c.QUERY_PARAM_EMPTY_WINDOW}=true`;else if((0,a.isFolderToOpen)(e)){const o=e.folderUri.scheme===b.Schemas.vscodeRemote?(0,P.encodePath)(e.folderUri.path):encodeURIComponent(e.folderUri.toString());r=`${document.location.origin}${document.location.pathname}?${c.QUERY_PARAM_FOLDER}=${o}`}else if((0,a.isWorkspaceToOpen)(e)){const o=e.workspaceUri.scheme===b.Schemas.vscodeRemote?(0,P.encodePath)(e.workspaceUri.path):encodeURIComponent(e.workspaceUri.toString());r=`${document.location.origin}${document.location.pathname}?${c.QUERY_PARAM_WORKSPACE}=${o}`}return(t==null?void 0:t.payload)&&(r+=`&${c.QUERY_PARAM_PAYLOAD}=${encodeURIComponent(JSON.stringify(t.payload))}`),r}isSame(e,t){return!e||!t?e===t:(0,a.isFolderToOpen)(e)&&(0,a.isFolderToOpen)(t)?(0,I.isEqual)(e.folderUri,t.folderUri):(0,a.isWorkspaceToOpen)(e)&&(0,a.isWorkspaceToOpen)(t)?(0,I.isEqual)(e.workspaceUri,t.workspaceUri):!1}hasRemote(){if(this.workspace){if((0,a.isFolderToOpen)(this.workspace))return this.workspace.folderUri.scheme===b.Schemas.vscodeRemote;if((0,a.isWorkspaceToOpen)(this.workspace))return this.workspace.workspaceUri.scheme===b.Schemas.vscodeRemote}return!0}}c.QUERY_PARAM_EMPTY_WINDOW="ew",c.QUERY_PARAM_FOLDER="folder",c.QUERY_PARAM_WORKSPACE="workspace",c.QUERY_PARAM_PAYLOAD="payload";class D{constructor(e){this.onDidChange=U.Event.None;let t,r;if(e){let o;(0,a.isFolderToOpen)(e)?o=e.folderUri:(0,a.isWorkspaceToOpen)(e)&&(o=e.workspaceUri),((o==null?void 0:o.scheme)==="github"||(o==null?void 0:o.scheme)==="codespace")&&([t,r]=o.authority.split("+"))}r&&t?(this.label=(0,S.localize)(0,null,t,r),this.tooltip=(0,S.localize)(1,null,t,r)):(this.label=(0,S.localize)(2,null),this.tooltip=(0,S.localize)(3,null))}}(function(){var f;const e=document.getElementById("vscode-workbench-web-configuration"),t=e?e.getAttribute("data-settings"):void 0;if(!e||!t)throw new Error("Missing web configuration element");const r=Object.assign({webviewEndpoint:`${window.location.origin}${window.location.pathname.replace(/\/+$/,"")}/webview`},JSON.parse(t)),o=y=>y.replace(/^https?:\/\//,"");r.remoteAuthority&&(r.remoteAuthority=o(r.remoteAuthority)),r.workspaceUri&&r.workspaceUri.authority&&(r.workspaceUri.authority=o(r.workspaceUri.authority)),r.folderUri&&r.folderUri.authority&&(r.folderUri.authority=o(r.folderUri.authority));let l=!1,i,R=((f=r.workspaceProvider)===null||f===void 0?void 0:f.payload)||Object.create(null);l||(r.folderUri?i={folderUri:d.URI.revive(r.folderUri)}:r.workspaceUri?i={workspaceUri:d.URI.revive(r.workspaceUri)}:i=void 0);const E=new c(i,R);let N;E.hasRemote()||(N=new D(i));const Q=y=>{let p=`quality=${y}`;new URL(document.location.href).searchParams.forEach((A,w)=>{w!=="quality"&&(p+=`&${w}=${A}`)}),window.location.href=`${window.location.origin}?${p}`},k=r.settingsSyncOptions?{enabled:r.settingsSyncOptions.enabled,enablementHandler:y=>{let p=`settingsSync=${y?"true":"false"}`;new URL(document.location.href).searchParams.forEach((A,w)=>{w!=="settingsSync"&&(p+=`&${w}=${A}`)}),window.location.href=`${window.location.origin}?${p}`}}:void 0;(0,u.create)(document.body,Object.assign(Object.assign({},r),{settingsSyncOptions:k,windowIndicator:N,productQualityChangeHandler:Q,workspaceProvider:E,urlCallbackProvider:new n,credentialsProvider:new m}))})()})}).call(this);

//# sourceMappingURL=workbench.js.map
