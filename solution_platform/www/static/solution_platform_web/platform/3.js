(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{1002:function(e,T,R){"use strict";!function(l){R.d(T,"a",function(){return S});R(507);var e=R(92),n=(R(508),R(54)),u=(R(115),R(38)),p=(R(184),R(101)),a=(R(512),R(239)),t=R(0),o=R.n(t),r=R(873),i=R.n(r),m=R(14),f=R(859),c=R(1003),d=R(1004),h=R(1005),v=R(1006),s=R(1),g=R(231),b=R(1007),y=R(940),t=R(1008),_=R.n(t),C=R(866),E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},r=function(e,t,n){return t&&L(e.prototype,t),n&&L(e,n),e};function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function j(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var S=m.a.decorator.contextTypes("store","router")((j(k,s["Component"]),r(k,[{key:"componentDidMount",value:function(){this.getComponentList()}},{key:"getComponentList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.search=Object.assign({},this.search,(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{})||{}),this.context.store.dispatch(Object(y.g)(e,t,this.search))}},{key:"delComponent",value:function(e){var t=this;e=Array.isArray(e)?e:[e],m.a.prompt.confirm(function(){return Object(y.d)(e).then(function(){t.context.store.dispatch(Object(y.a)(e)),m.a.prompt.success("删除成功"),t.handerRefresh()},function(e){m.a.prompt.error(e.msg)})},{title:"确定删除？"})}},{key:"handerRefresh",value:function(){var e=this.props.componentListReducer.componentList,t=e.currentPage,t=1===e.data.length&&1<t?t-1:t;this.getComponentList(t,this.search.type,this.search)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setState({componentList:e.componentListReducer.componentList})}},{key:"render",value:function(){var n=this,e=this.props.componentListReducer.loading,t=this.state,o=t.changeComponentId,r=t.componentList,a=void 0===r?{}:r,i=a.count,c=void 0===i?0:i,t=a.currentPage,r=void 0===t?1:t,i=a.pageSize,t=a.data,a=void 0===t?[]:t,s=(m.a.auth.getLoginInfo()||{}).isAdmin,a=a.map(function(e){return e.cover=Object(b.a)(e.component_mark,e.account_id),e}),t=[{title:"名称",dataIndex:"name"},{title:"组织名称",dataIndex:"org_name"},{title:"组件标识",dataIndex:"component_mark"},{title:"组件封面",dataIndex:"cover",render:function(e){return l.createElement("img",{src:e,style:{width:80,height:50},onError:function(e){e.target.src=_.a,e.onError=null}})}},{title:"创建时间",dataIndex:"created_at",render:function(e){return m.a.helper.dateFormat(e)}},{title:"操作",render:function(e,t){return[l.createElement(d.a,{key:1,type:"primary",icon:"edit",disabled:!s&&"comonComponent"===t.org_mark,onClick:function(){return m.a.helper.renderModal(l.createElement(h.a,{component_id:t.component_id,getComponentListCb:n.getComponentList.bind(n)}))}},"更新组件"),l.createElement(d.a,{key:2,type:"primary",icon:"edit",disabled:!s&&"comonComponent"===t.org_mark,style:{marginLeft:5},onClick:function(){return m.a.helper.renderModal(l.createElement(v.a,{component_id:t.component_id,getComponentListCb:n.getComponentList.bind(n)}))}},"更新封面"),l.createElement(d.a,{key:3,type:"danger",icon:"delete",disabled:!s&&"comonComponent"===t.org_mark,onClick:function(){n.delComponent(t.component_id)},style:{marginLeft:5}},"删除"),s?l.createElement(p.a,{key:4,title:"隐藏将在编辑大屏时不会出现在可选组件中, 并不影响在用大屏"},l.createElement(d.a,{type:"dashed",loading:o===t.component_id,icon:0===t.is_hide?"stop":"check-circle",onClick:function(){return n.changeVisible(t.component_id,0===t.is_hide?1:0)},style:{marginLeft:5}},0===t.is_hide?"隐藏":"显示")):null]}}];return l.createElement("div",null,l.createElement(g.b,{title:"组件列表",rightRender:l.createElement(u.a,{type:"primary",icon:"plus",onClick:function(){return m.a.helper.renderModal(l.createElement(h.a,{component_id:!1,getComponentListCb:n.getComponentList.bind(n)}))}},"添加组件")}),l.createElement(g.a,null,l.createElement(P,{doSearch:function(e){n.search=e,n.getComponentList(1,e.type,e)}}),l.createElement(f.a,{dataSource:a,columns:t,pagination:{current:r,pageSize:i,total:c,onChange:function(e){return n.getComponentList(e)}},loading:e,rowKey:function(e){return e.component_id}})))}}]),t=k))||t;function k(e){O(this,k);var r=w(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,e));return r.changeVisible=function(t,n){r.setState({changeComponentId:t});var o=r.state.componentList;Object(y.c)({component_id:t,is_hide:n}).then(function(e){r.setState({changeing:!1}),0===e.code?r.setState({componentList:E({},o,{data:o.data.map(function(e){return E({},e,{is_hide:e.component_id===t?n:e.is_hide})})}),changeComponentId:null}):a.a.error("更改组件可见状态失败, 请重试!")})},r.search={},r.state={changeComponentId:null,componentList:e.componentListReducer.componentList},r}var P=m.a.decorator.propTypes({doSearch:o.a.func.isRequired})((j(x,s["Component"]),r(x,[{key:"render",value:function(){var t=this;return l.createElement(e.a,{gutter:0,type:"flex",align:"middle",className:i.a.filter},l.createElement(n.a,{span:5},l.createElement(c.a,{title:"名称",value:this.state.name,onChange:function(e){return t.setState({name:e.target.value.trim()})},onBlur:function(){return t.doSearch()},onKeyDown:function(e){return 13===e.keyCode&&t.doSearch()}})),l.createElement("span",{style:{marginLeft:"15px"}},"标签："),l.createElement(n.a,{span:5},l.createElement(C.a,{style:{width:"100%"},value:this.state.tagList,onChange:function(e){return t.setState({tagList:e},function(){return t.doSearch()})},allowClear:!0,mode:"multiple"})))}}]),r=x))||r;function x(){O(this,x);var n=w(this,(x.__proto__||Object.getPrototypeOf(x)).call(this));return n.doSearch=function(){var e=n.props.doSearch,t=m.a.lodash.clone(n.state);m.a.lodash.isEmpty(t.name)&&delete t.name,m.a.lodash.isEmpty(t.tagList)?delete t.tagList:t.tagList=t.tagList.join(","),e(t)},n.state={name:null,tagList:[]},n}}.call(this,R(1))},1003:function(e,t,i){"use strict";!function(n){i(230);var o=i(232),e=i(924),r=i.n(e),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};t.a=function(e){var t=function(e,t){var n,o={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(o[n]=e[n]);return o}(e,[]),e=a({},t).title;return n.createElement("div",{className:r.a.Tj_Input},n.createElement("span",{className:r.a.title},e,":"),n.createElement(o.a,t))}}.call(this,i(1))},1004:function(e,a,i){"use strict";!function(t){i(115);var n=i(38),e=i(925),o=i.n(e),r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};a.a=function(e){e=function(e,t){var n,o={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(o[n]=e[n]);return o}(e,[]);return t.createElement(n.a,r({className:o.a.Tj_Button},e),r({},e).children)}}.call(this,i(1))},1005:function(e,b,y){"use strict";!function(i){y.d(b,"a",function(){return a});y(865);var c=y(867),s=(y(234),y(9)),l=(y(507),y(92)),u=(y(508),y(54)),p=(y(115),y(38)),e=y(0),t=y.n(e),m=y(14),n=y(873),f=y.n(n),e=y(1),d=y(945),h=y(866),v=y(940),o=y(241),n=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e};function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a=m.a.decorator.propTypes({component_id:t.a.oneOfType([t.a.number,t.a.string,t.a.bool]).isRequired,getComponentListCb:t.a.func.isRequired})((function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(g,e.Component),n(g,[{key:"componentDidMount",value:function(){this.setState({visible:!0}),this.fetchTagInfo()}},{key:"render",value:function(){var e=this,t=this.props.component_id,n=this.state,o=n.saving,r=n.visible,a=(n.componentList,n.selectTag),n={multiple:!1,onRemove:function(n){e.setState(function(e){var t=e.componentList,e=t.indexOf(n),t=t.slice();return t.splice(e,1),{componentList:t}})},beforeUpload:function(t){return e.setState(function(e){e.componentList;return{componentList:[t]}}),!1},fileList:this.state.componentList};return console.log(a),i.createElement(d.a,{title:t?"编辑组件":"创建组件",visible:r,onCancel:function(){return e.setState({visible:!1})},footer:[i.createElement(p.a,{key:"back",onClick:function(){return e.setState({visible:!1})}},"取消"),i.createElement(p.a,{key:"submit",type:"primary",loading:o,onClick:this.saveComponent},"保存")],className:f.a.uploadBox},i.createElement(l.a,{type:"flex",align:"middle",justify:"center"},i.createElement(u.a,{span:6,className:"ant-form-item-label"},i.createElement("label",{className:"ant-form-item-required"},"选择标签")),i.createElement(u.a,{span:10,className:"ant-form-item-control"},i.createElement(h.a,{needDefault:!0,value:a,mode:"tag",className:f.a.tagSelect,onChange:this.handleSelectChange}))),i.createElement(l.a,{className:f.a.col,type:"flex",align:"top",justify:"center"},i.createElement(u.a,{span:6,className:"ant-form-item-label"},i.createElement("label",{className:t?"":"ant-form-item-required"},"选择组件")),i.createElement(u.a,{span:10,className:"ant-form-item-control"},i.createElement(c.a,n,i.createElement(p.a,null,i.createElement(s.a,{type:"upload"})," 选择组件")))))}}]),g.defaultProps={component_id:!1,getComponentListCb:function(){}},n=g))||n;function g(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return i.fetchTagInfo=function(){var e=i.props.component_id;e&&i.setState({saving:!0},function(){Object(o.e)(e).then(function(e){var t=e.code,e=e.data;console.log(t,e),!t&&e&&i.setState({selectTag:e})}).finally(function(){i.setState({saving:!1})}).catch(function(e){m.a.prompt.error("获取标签信息失败")})})},i.saveComponent=function(){var e=i.state,r=e.componentList,e=e.selectTag,a=i.props.component_id;return!a&&r.length<1?(m.a.prompt.error("请选择要上传的文件"),!1):e?void i.setState({saving:!0},function(){var e,t=i.state.selectTag,n=!a,o=[function(){i.setState({saving:!1,visible:!1}),i.props.getComponentListCb(),m.a.prompt.success(n?"创建成功":"修改成功")},function(e){i.setState({saving:!1}),m.a.prompt.error(e.msg)}];n?(e=Object(v.b)({componentList:r,tag_id:t},function(e){var t=e.loaded,e=e.total;i.setState({uploadProgress:100*Math.floor(t/e)})})).then.apply(e,o):(t=Object(v.e)({component_id:a,tag_id:t,component:r})).then.apply(t,o)}):(m.a.prompt.error("请选择标签"),!1)},i.handleSelectChange=function(e){i.setState({selectTag:e})},i.state={saving:!1,visible:!1,selectTag:null,componentList:[]},i}}.call(this,y(1))},1006:function(e,h,v){"use strict";!function(a){v.d(h,"a",function(){return f});v(507);var i=v(92),c=(v(508),v(54)),s=(v(865),v(867)),l=(v(234),v(9)),u=(v(115),v(38)),e=v(0),t=v.n(e),p=v(14),n=v(1),m=v(945),r=v(940),e=(v(23),function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e});function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f=p.a.decorator.propTypes({component_id:t.a.oneOfType([t.a.number,t.a.string,t.a.bool]).isRequired,getComponentListCb:t.a.func.isRequired})((function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,n.Component),e(d,[{key:"componentDidMount",value:function(){this.setState({visible:!0})}},{key:"render",value:function(){var o=this,e=this.state,t=e.saving,n=e.visible,r=e.coverList,e=(e.previewVisible,e.previewImage,{accept:"image/*",fileList:r,onPreview:function(e){o.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})},onRemove:function(n){o.setState(function(e){var t=e.coverList,e=t.indexOf(n),t=t.slice();return t.splice(e,1),{coverList:t}})},beforeUpload:function(t){return o.setState(function(e){e.coverList;return{coverList:[t]}}),!1}});return a.createElement(m.a,{title:"上传封面",key:1,visible:n,onCancel:function(){return o.setState({visible:!1})},footer:[a.createElement(u.a,{key:"back",onClick:function(){return o.setState({visible:!1})}},"取消"),a.createElement(u.a,{key:"submit",type:"primary",loading:t,onClick:this.saveCover},"保存")]},a.createElement(i.a,{type:"flex",align:"middle",justify:"center"},a.createElement(c.a,{span:18},a.createElement(s.a,e,a.createElement(u.a,null,a.createElement(l.a,{type:"upload"})," 选择封面")),0<r.length&&a.createElement("ul",null,a.createElement("li",null,"文件名称：",r[0].name),a.createElement("li",null,"文件大小：",(r[0].size/1024).toFixed(2)," KB"),a.createElement("li",null,"文件类型：",r[0].type),a.createElement("li",null,"最近修改时间:",p.a.helper.dateFormat(r[0].lastModified))))))}}]),d.defaultProps={component_id:!1,getComponentListCb:function(){}},e=d))||e;function d(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));return o.saveCover=function(){var n=o.state.coverList;if(n.length<1)return p.a.prompt.error("请选择要上传的文件"),!1;o.setState({saving:!0},function(){var e=o.props.component_id,t=[function(){o.setState({saving:!1,visible:!1}),o.props.getComponentListCb(),p.a.prompt.success("上传成功")},function(e){o.setState({saving:!1}),p.a.prompt.error(e.msg)}];(e=Object(r.f)({component_id:e,cover:n})).then.apply(e,t)})},o.state={saving:!1,visible:!1,previewVisible:!1,previewImage:"",coverList:[]},o}}.call(this,v(1))},1007:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(e,t){return window.ENV.apiDomain+"/static/public_visual_component/"+t+"/"+e+"/cover.png?random="+Date.now()}},1008:function(e,t,n){e.exports=n.p+"ee42f0dcec35171b57165c869d9e8228.png"},923:function(e,a,i){"use strict";i.r(a),function(e){var t=i(229),n=i(1002),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},r=Object(t.b)(function(e,t){return o({},t,{componentListReducer:e.componentListReducer})})(n.a);a.default=function(){return e.createElement(r,null)}}.call(this,i(1))},940:function(e,t,n){"use strict";n.d(t,"g",function(){return l}),n.d(t,"d",function(){return u}),n.d(t,"a",function(){return p}),n.d(t,"b",function(){return m}),n.d(t,"e",function(){return f}),n.d(t,"c",function(){return d}),n.d(t,"f",function(){return h});var r=n(175),a=n(14),i=n(23),n=a.a.request,c=n.get,o=n.del,s=n.upload,l=function(e,n){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return function(t){t({type:r.b}),function(e,t){return c(i.a.dvComponents_getPageList,{page:e,type:t,search:2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}})}(e,n,o).then(function(e){t({type:r.c,componentList:e.data})},function(e){a.a.prompt.error(e.msg)})}},u=function(e){return o(i.a.dvComponents_delComponent,{component_ids:e})},p=function(e){return{type:r.a,component_ids:e}},m=function(e,t){return function(){return s(i.a.dvComponents_addComponent,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},arguments[1])}(e,t)},f=function(e){return s(i.a.dvComponents_updateComponent,e)},d=function(e){return s(i.a.dvComponents_changeVisible,e)},h=function(e){return s(i.a.dvComponents_uploadComponentCover,e)}},945:function(e,i,c){"use strict";!function(t){c(856);var n=c(857),e=c(926),o=c.n(e),e=c(10),r=c.n(e),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};i.a=function(e){return t.createElement(n.a,a({},e,{className:r()(o.a.tj_modalBox,e.className)}),e.children)}}.call(this,c(1))}}]);