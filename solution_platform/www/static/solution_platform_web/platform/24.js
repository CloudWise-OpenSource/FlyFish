(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{930:function(e,t,a){"use strict";a.r(t);a(136);var u=a(72),d=(a(238),a(156)),g=(a(510),a(237)),p=(a(507),a(92)),f=(a(508),a(54)),h=(a(230),a(232)),m=(a(917),a(922)),l=(a(512),a(239)),s=(a(856),a(857)),r=(a(918),a(921)),b=(a(115),a(38)),i=(a(184),a(101)),c=(a(234),a(9)),y=(a(513),a(242)),v=a(1),E=a.n(v),T=a(231),w=(a(861),a(862)),n=a(0),o=a.n(n),S=a(919),O=a.n(S),C=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,r=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw i}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=function(){},k=/^[\u4e00-\u9fa5\w]*$/,j={labelCol:{span:4},wrapperCol:{span:16}},S=function(e){var t=e.visible,a=e.edit,n=e.loading,r=e.onCancel,i=e.onSubmit,o=e.form,l=o.resetFields,e=o.getFieldDecorator,c=o.validateFields,o=function(e){return e&&e.trim()};return E.a.createElement(s.a,{visible:t,title:(a?"编辑":"新建")+"标签",onOk:function(){n||c(function(e,t){e||i(t)})},onCancel:function(){n||r()},afterClose:l,okButtonProps:{loading:n},cancelButtonProps:{loading:n}},E.a.createElement(w.a,{layout:"horizontal"},E.a.createElement(w.a.Item,x({label:"标签名称"},j),e("name",{rules:[{required:!0,message:"请输入正确标签名称",min:2,max:20,whitespace:!0,pattern:k}],normalize:o})(E.a.createElement(h.a,{placeholder:"请输入标签名称",maxLength:20}))),E.a.createElement(w.a.Item,x({label:"标签描述"},j),e("description",{rules:[{required:!0,message:"请输入正确标签描述",min:0,max:50,whitespace:!0,pattern:k}],normalize:o})(E.a.createElement(h.a.TextArea,{className:O.a.addTagTextarea,row:3,placeholder:"请输入标签描述",maxLength:50})))))};S.defaultProps={visible:!1,edit:!1,loading:!1,onSubmit:n,onCancel:n,initialValue:{}},S.propTypes={visible:o.a.bool.isRequired,edit:o.a.bool.isRequired,loading:o.a.bool.isRequired,onSubmit:o.a.func.isRequired,onCancel:o.a.func.isRequired,initialValue:o.a.object};var L=w.a.create({mapPropsToFields:function(e){e=e.initialValue;return Object.fromEntries(Object.entries(e).map(function(e){var t=C(e,2),e=t[0],t=t[1];return[e,w.a.createFormField({value:t})]}))}})(S),S=a(10),P=a.n(S),S=a(920),V=a.n(S),R=a(241),M=1,A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},a=function(e,t,a){return t&&q(e.prototype,t),a&&q(e,a),e};function q(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function F(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var I="默认标签不可删除！",_={total:0,current:0,pageSize:10},a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(z,v.Component),a(z,[{key:"componentDidMount",value:function(){this.fetchTagList()}},{key:"render",value:function(){var t=this,e=this.state,a=e.loading,n=e.selectedRowKeys,r=e.addTagModalVisible,i=e.edit,o=e.operating,l=e.currentEditTag,c=e.tagList,s=e.page,e={selectedRowKeys:n,onChange:function(e){return t.tableSelectionChange(e)},getCheckboxProps:function(e){return{disabled:e.id===M}}};return E.a.createElement(u.a,{spinning:o,tip:"正在执行操作中..."},E.a.createElement(T.b,{title:"标签管理"}),E.a.createElement(T.a,{className:V.a.wrapper},E.a.createElement(m.a,{className:V.a.gap,showIcon:!0,message:"提示信息",description:"针对大屏和组件进行分类管理, 注意标签的删除并不会影响目前现有大屏的行为！",type:"info"}),E.a.createElement(p.a,{type:"flex",justify:"space-between",className:V.a.gap},E.a.createElement(f.a,{span:16},E.a.createElement(h.a.Search,{enterButton:"搜索标签",placeholder:"请输入标签关键字或完整标签名",onSearch:this.handleSearch})),E.a.createElement(f.a,{span:5},E.a.createElement(p.a,{type:"flex",justify:"space-between"},E.a.createElement(f.a,null,E.a.createElement(b.a,{ghost:!0,type:"primary",onClick:this.changeAddTagModalVisible,icon:"plus",loading:o},"新建标签")),E.a.createElement(f.a,null,E.a.createElement(b.a,{ghost:!0,type:"danger",onClick:function(){return t.deleteTag(n)},icon:"delete",disabled:!n.length,loading:o},"批量删除"))))),E.a.createElement(g.a,{columns:this.dataColumns,rowSelection:e,loading:a,rowKey:"id",className:P()(V.a.table,V.a.gap),dataSource:c,scroll:this.computedTableScrollY(),pagination:!1}),E.a.createElement(d.a,A({simple:!0,defaultCurrent:1,onChange:this.fetchTagList},s)),E.a.createElement(L,{visible:r,edit:i,initialValue:l,onSubmit:this.addOrEditTag,onCancel:this.onCancel,loading:o})))}}]),z);function z(){var e,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,z);for(var t=arguments.length,a=Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=o=F(this,(e=z.__proto__||Object.getPrototypeOf(z)).call.apply(e,[this].concat(a)))).state={addTagModalVisible:!1,loading:!1,selectedRowKeys:[],edit:!1,operating:!1,currentEditTag:{},tagList:[],page:_,searchTagWord:""},o.dataColumns=[{title:"序号",dataIndex:"index",key:"index",width:80},{title:"标签名称",dataIndex:"name",width:300,ellipsis:!0,key:"name",render:function(e,t){t=t.id===M;return E.a.createElement(v.Fragment,null,E.a.createElement(y.a,{color:t?"blue":"green"},e),t?E.a.createElement(i.a,{text:!0,title:I},E.a.createElement("span",null,E.a.createElement(c.a,{type:"question-circle"}))):null)}},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",dataIndex:"id",key:"id",width:220,render:function(e,t){var a=o.state.operating,n=e===M;return E.a.createElement(v.Fragment,null,E.a.createElement(b.a,{ghost:!0,type:"primary",onClick:function(){o.setState({currentEditTag:t}),o.changeAddTagModalVisible()},loading:a,disabled:n},"编辑"),E.a.createElement(r.a,{type:"vertical"}),E.a.createElement(b.a,{ghost:!0,type:"danger",onClick:function(){return o.deleteTag(e)},loading:a,disabled:n},"删除"))}}],o.fetchTagList=function(e){o.toggleLoadDataLoading();var t=o.state,a=t.page,t=t.searchTagWord;Object(R.d)({page:e||a.current||a.current+1,search:t,status:1}).then(function(e){var t,a,n=e.code,r=e.data;n||(t=r.count,e=r.currentPage,n=r.pageSize,r=r.data,o.setState({page:{total:void 0===t?0:t,current:a=void 0===e?1:e,pageSize:void 0===n?10:n},tagList:(void 0===r?[]:r).map(function(e,t){return A({},e,{index:10*(a-1)+1+t})})}))}).finally(function(){o.toggleLoadDataLoading()})},o.tableSelectionChange=function(e){o.setState({selectedRowKeys:e})},o.changeAddTagModalVisible=function(){o.setState({addTagModalVisible:!o.state.addTagModalVisible})},o.deleteTag=function(a){var e=o.state,t=e.operating,n=e.selectedRowKeys,r=e.tagList,i=e.page;s.a.confirm({title:"提示",content:"您是否确认删除当前选中标签?",okText:"确认删除",cancelText:"我再想想",okButtonProps:{loading:t},cancelButtonProps:{loading:t},onOk:function(){o.toggleOperateStatus();var t=[[a]].flat(1/0),e={id:t};Object(R.b)(e).then(function(e){e.code||(l.a.success("删除成功！"),o.tableSelectionChange(n.filter(function(e){return!t.includes(e)})),e=i.current,r.length===t.length&&1<i.current&&--e,o.fetchTagList(e))}).finally(function(){o.toggleOperateStatus()}).catch(function(e){l.a.error("删除失败!")})}})},o.addOrEditTag=function(e){var t=o.state.currentEditTag;o.toggleOperateStatus();var a=R.a,n=!1;t.id&&(a=R.c,e=A({},t,e),n=!0),a(e).then(function(e){e.code||(o.fetchTagList(),l.a.success((n?"编辑":"新建")+"成功"),o.changeAddTagModalVisible())}).finally(function(){o.toggleOperateStatus()}).catch(function(e){l.a.error((n?"编辑":"新建")+"失败")})},o.toggleOperateStatus=function(){o.setState({operating:!o.state.operating})},o.toggleLoadDataLoading=function(){o.setState({loading:!o.state.loading})},o.onCancel=function(){o.setState({currentEditTag:{}}),o.changeAddTagModalVisible()},o.computedTableScrollY=function(){var e=document.body.clientHeight;return{y:(void 0===e?0:e)/10*6.5-71}},o.handleSearch=function(e){o.setState({searchTagWord:e},function(){o.fetchTagList(1)})},F(o,e)}t.default=a}}]);