(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{927:function(e,t,a){"use strict";a.r(t);a(136);function n(){}function r(e){function t(e){return e&&e.trim()}var a=e.visible,n=e.edit,r=e.loading,i=e.onCancel,o=e.onSubmit,l=e.form,c=l.resetFields,e=l.getFieldDecorator,s=l.validateFields;return T.a.createElement(b.a,{visible:a,title:(n?"编辑":"新建")+"标签",onOk:function(){r||s(function(e,t){e||o(t)})},onCancel:function(){r||i()},afterClose:c,okButtonProps:{loading:r},cancelButtonProps:{loading:r}},T.a.createElement(S.a,{layout:"horizontal"},T.a.createElement(S.a.Item,k({label:"标签名称"},L),e("name",{rules:[{required:!0,message:"请输入正确标签名称",min:2,max:20,whitespace:!0,pattern:j}],normalize:t})(T.a.createElement(h.a,{placeholder:"请输入标签名称",maxLength:20}))),T.a.createElement(S.a.Item,k({label:"标签描述"},L),e("description",{rules:[{required:!0,message:"请输入正确标签描述",min:0,max:50,whitespace:!0,pattern:j}],normalize:t})(T.a.createElement(h.a.TextArea,{className:C.a.addTagTextarea,row:3,placeholder:"请输入标签描述",maxLength:50})))))}var u=a(72),d=(a(238),a(156)),g=(a(509),a(237)),p=(a(506),a(92)),f=(a(507),a(54)),h=(a(229),a(232)),m=(a(914),a(919)),l=(a(511),a(239)),b=(a(855),a(856)),i=(a(915),a(918)),y=(a(115),a(38)),c=(a(184),a(101)),s=(a(234),a(9)),v=(a(512),a(242)),E=a(1),T=a.n(E),w=a(231),S=(a(860),a(861)),o=a(0),O=a.n(o),o=a(916),C=a.n(o),x=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,r=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw i}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},j=/^[\u4e00-\u9fa5\w]*$/,L={labelCol:{span:4},wrapperCol:{span:16}};r.defaultProps={visible:!1,edit:!1,loading:!1,onSubmit:n,onCancel:n,initialValue:{}},r.propTypes={visible:O.a.bool.isRequired,edit:O.a.bool.isRequired,loading:O.a.bool.isRequired,onSubmit:O.a.func.isRequired,onCancel:O.a.func.isRequired,initialValue:O.a.object};var P=S.a.create({mapPropsToFields:function(e){e=e.initialValue;return Object.fromEntries(Object.entries(e).map(function(e){var t=x(e,2),e=t[0],t=t[1];return[e,S.a.createFormField({value:t})]}))}})(r),O=a(10),V=a.n(O),O=a(917),R=a.n(O),M=a(241),A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},a=function(e,t,a){return t&&q(e.prototype,t),a&&q(e,a),e};function q(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function F(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var I={total:0,current:0,pageSize:10},a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(_,E.Component),a(_,[{key:"componentDidMount",value:function(){this.fetchTagList()}},{key:"render",value:function(){var t=this,e=this.state,a=e.loading,n=e.selectedRowKeys,r=e.addTagModalVisible,i=e.edit,o=e.operating,l=e.currentEditTag,c=e.tagList,s=e.page,e={selectedRowKeys:n,onChange:function(e){return t.tableSelectionChange(e)},getCheckboxProps:function(e){return{disabled:1===e.id}}};return T.a.createElement(u.a,{spinning:o,tip:"正在执行操作中..."},T.a.createElement(w.b,{title:"标签管理"}),T.a.createElement(w.a,{className:R.a.wrapper},T.a.createElement(m.a,{className:R.a.gap,showIcon:!0,message:"提示信息",description:"针对大屏和组件进行分类管理, 注意标签的删除并不会影响目前现有大屏的行为！",type:"info"}),T.a.createElement(p.a,{type:"flex",justify:"space-between",className:R.a.gap},T.a.createElement(f.a,{span:16},T.a.createElement(h.a.Search,{enterButton:"搜索标签",placeholder:"请输入标签关键字或完整标签名",onSearch:this.handleSearch})),T.a.createElement(f.a,{span:5},T.a.createElement(p.a,{type:"flex",justify:"space-between"},T.a.createElement(f.a,null,T.a.createElement(y.a,{ghost:!0,type:"primary",onClick:this.changeAddTagModalVisible,icon:"plus",loading:o},"新建标签")),T.a.createElement(f.a,null,T.a.createElement(y.a,{ghost:!0,type:"danger",onClick:function(){return t.deleteTag(n)},icon:"delete",disabled:!n.length,loading:o},"批量删除"))))),T.a.createElement(g.a,{columns:this.dataColumns,rowSelection:e,loading:a,rowKey:"id",className:V()(R.a.table,R.a.gap),dataSource:c,scroll:this.computedTableScrollY(),pagination:!1}),T.a.createElement(d.a,A({simple:!0,defaultCurrent:1,onChange:this.fetchTagList},s)),T.a.createElement(P,{visible:r,edit:i,initialValue:l,onSubmit:this.addOrEditTag,onCancel:this.onCancel,loading:o})))}}]),_);function _(){var e,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_);for(var t=arguments.length,a=Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=o=F(this,(e=_.__proto__||Object.getPrototypeOf(_)).call.apply(e,[this].concat(a)))).state={addTagModalVisible:!1,loading:!1,selectedRowKeys:[],edit:!1,operating:!1,currentEditTag:{},tagList:[],page:I,searchTagWord:""},o.dataColumns=[{title:"序号",dataIndex:"index",key:"index",width:80},{title:"标签名称",dataIndex:"name",width:300,ellipsis:!0,key:"name",render:function(e,t){t=1===t.id;return T.a.createElement(E.Fragment,null,T.a.createElement(v.a,{color:t?"blue":"green"},e),t?T.a.createElement(c.a,{text:!0,title:"默认标签不可删除！"},T.a.createElement("span",null,T.a.createElement(s.a,{type:"question-circle"}))):null)}},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",dataIndex:"id",key:"id",width:220,render:function(e,t){var a=o.state.operating,n=1===e;return T.a.createElement(E.Fragment,null,T.a.createElement(y.a,{ghost:!0,type:"primary",onClick:function(){o.setState({currentEditTag:t}),o.changeAddTagModalVisible()},loading:a,disabled:n},"编辑"),T.a.createElement(i.a,{type:"vertical"}),T.a.createElement(y.a,{ghost:!0,type:"danger",onClick:function(){return o.deleteTag(e)},loading:a,disabled:n},"删除"))}}],o.fetchTagList=function(e){o.toggleLoadDataLoading();var t=o.state,a=t.page,t=t.searchTagWord;Object(M.d)({page:e||a.current||a.current+1,search:t,status:1}).then(function(e){var t,a,n=e.code,r=e.data;n||(t=r.count,e=r.currentPage,n=r.pageSize,r=r.data,o.setState({page:{total:void 0===t?0:t,current:a=void 0===e?1:e,pageSize:void 0===n?10:n},tagList:(void 0===r?[]:r).map(function(e,t){return A({},e,{index:10*(a-1)+1+t})})}))}).finally(function(){o.toggleLoadDataLoading()})},o.tableSelectionChange=function(e){o.setState({selectedRowKeys:e})},o.changeAddTagModalVisible=function(){o.setState({addTagModalVisible:!o.state.addTagModalVisible})},o.deleteTag=function(a){var e=o.state,t=e.operating,n=e.selectedRowKeys,r=e.tagList,i=e.page;b.a.confirm({title:"提示",content:"您是否确认删除当前选中标签?",okText:"确认删除",cancelText:"我再想想",okButtonProps:{loading:t},cancelButtonProps:{loading:t},onOk:function(){o.toggleOperateStatus();var t=[[a]].flat(1/0),e={id:t};Object(M.b)(e).then(function(e){e.code||(l.a.success("删除成功！"),o.tableSelectionChange(n.filter(function(e){return!t.includes(e)})),e=i.current,r.length===t.length&&1<i.current&&--e,o.fetchTagList(e))}).finally(function(){o.toggleOperateStatus()}).catch(function(e){l.a.error("删除失败!")})}})},o.addOrEditTag=function(e){var t=o.state.currentEditTag;o.toggleOperateStatus();var a=M.a,n=!1;t.id&&(a=M.c,e=A({},t,e),n=!0),a(e).then(function(e){e.code||(o.fetchTagList(),l.a.success((n?"编辑":"新建")+"成功"),o.changeAddTagModalVisible())}).finally(function(){o.toggleOperateStatus()}).catch(function(e){l.a.error((n?"编辑":"新建")+"失败")})},o.toggleOperateStatus=function(){o.setState({operating:!o.state.operating})},o.toggleLoadDataLoading=function(){o.setState({loading:!o.state.loading})},o.onCancel=function(){o.setState({currentEditTag:{}}),o.changeAddTagModalVisible()},o.computedTableScrollY=function(){var e=document.body.clientHeight;return{y:(void 0===e?0:e)/10*6.5-71}},o.handleSearch=function(e){o.setState({searchTagWord:e},function(){o.fetchTagList(1)})},F(o,e)}t.default=a}}]);