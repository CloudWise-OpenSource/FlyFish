(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{905:function(t,r,o){"use strict";o.r(r),function(t){var e=o(230),a=o(987),n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a,n=arguments[e];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},i=Object(e.b)(function(t,e){return n({},e)})(a.a);r.default=function(){return t.createElement(i,null)}}.call(this,o(1))},940:function(t,e,a){"use strict";a.d(e,"a",function(){return o});var n=a(0),e=a.n(n),n=a(429),i=a(14),a=function(t,e,a){return e&&r(t.prototype,e),a&&r(t,a),t};function r(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=i.a.decorator.propTypes({option:e.a.object.isRequired})((function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(l,n.a),a(l,[{key:"buildChartOptions",value:function(){return i.a.lodash.defaultsDeep(this.props.option,{chart:{type:"xy"},title:{text:""},subtitle:{text:""},xAxis:{allowDecimals:!1,labels:{formatter:function(){return this.value}}},yAxis:{title:{text:""},labels:{formatter:function(){return this.value/1e3+"k"}}},plotOptions:{area:{pointStart:1940,marker:{enabled:!1,symbol:"circle",radius:2,states:{hover:{enabled:!0}}}}}})}}]),a=l))||a;function l(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(l.__proto__||Object.getPrototypeOf(l)).apply(this,arguments))}},949:function(t,e,a){"use strict";a.d(e,"d",function(){return n}),a.d(e,"a",function(){return i}),a.d(e,"b",function(){return l}),a.d(e,"c",function(){return s});var e=a(14),r=a(23),e=e.a.request,o=(e.get,e.postJSON),n=(e.all,function(){return o(r.a.getLogTypeListAPI,{page:1,pageSize:1e4})}),i=function(t,e,a){return o(r.a.getCollectDataAPI,{logType:t,pluginType:e,timeRange:a})},l=function(t,e,a,n,i){return o(r.a.getCollectListAPI,{logType:t,page:e,pageSize:a,pluginType:n,timeRange:i})},s=function(t,e,a,n){return o(r.a.getDetailAPI,{logType:t,timeRange:e,ip:a,pluginType:n})}},987:function(t,i,T){"use strict";!function(o){T.d(i,"a",function(){return a});T(509);var l=T(237),s=(T(506),T(92)),u=(T(507),T(54)),c=(T(508),T(235)),p=(T(183),T(68)),t=T(906),f=T.n(t),h=T(14),m=T(940),r=T(988),g=T(857),d=T(859),e=T(1),y=T(231),b=T(949),t=function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t};function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var x=p.a.Option,a=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(S,e.PureComponent),t(S,[{key:"componentDidMount",value:function(){var e=this,t=this.state,a=t.logType,n=t.pluginType,i=t.timeRange,r=t.page,o=t.pageSize,l=[];Object(b.d)().then(function(t){t.data.list.map(function(t,e){t={value:t.logType,label:t.logTypeName};l.push(t)}),e.setState({logTypeList:l})},function(t){h.a.prompt.error(t.msg)});t=this.state.logType;this.getCollectData(a,n,i,t,"log"),this.getCollectList(a,r,o,n,i)}},{key:"getCollectData",value:function(t,e,a,n,i){var r=this;Object(b.a)(t,e,a,n,i).then(function(t){switch(r.dataFormat(t.data),i){case"time":r.setState({chartLoading:!1,timeRange:n});break;case"log":r.setState({chartLoading:!1,logType:n});break;case"plugin":r.setState({chartLoading:!1,pluginType:n})}},function(t){h.a.prompt.error(t.msg)})}},{key:"getCollectList",value:function(t,e,a,n,i){var r=this;Object(b.b)(t,e,a,n,i).then(function(t){null!=t.data&&r.listDataFormat(t.data),r.setState({tableLoading:!1})},function(t){h.a.prompt.error(t.msg)})}},{key:"listDataFormat",value:function(t){var t=t.list,r=[];t.map(function(a,n){var t=a.consumRate.split("=")[3].split("%"),i=Number(t[0]);a.pluginList.map(function(t,e){t={key:String(n)+String(e),hubStatus:String(a.hubStatus),hostIP:a.nodeIp,pluginType:t.pluginType,pluginStatus:String(a.hubStatus),pluginData:String((i/100).toFixed(3))};r.push(t)})}),this.setState({tableList:r})}},{key:"dataFormat",value:function(t){var a=t.collectList,e=t.produceList,n=t.receiveList,i=t.sendList,r=[],o=[],l=[],s=[],u=[],c=[],p=[];a&&a.map(function(t,e){var a=t.time.split(" ")[1].split(":"),a=a[0]+":"+a[1];r.push(a),o.push(t.dataSize)}),e&&e.map(function(t,e){l.push(t.dataSize),c.push((a[e].dataSize/t.dataSize).toFixed(3))}),i&&i.map(function(t,e){u.push(t.dataSize)}),n&&n.map(function(t,e){s.push(t.dataSize),p.push((i[e].dataSize/t.dataSize).toFixed(3))}),this.setState({chartData:{xTime:r,collectList:o,produceList:l,sendList:u,receiveList:s,cp:c,sr:p}})}},{key:"changeTime",value:function(t){var e=this.state,a=e.logType,n=e.pluginType;e.timeRange;this.getCollectData(a,n,t,t,"time")}},{key:"changePlugin",value:function(t){var e=this.state,a=e.logType,n=e.pluginType,i=e.timeRange,r=e.page,e=e.pageSize;this.getCollectData(a,n=t,i,t,"plugin"),this.getCollectList(a,r,e,n,i)}},{key:"changeLogType",value:function(t){var e=this.state,a=(e.logType,e.pluginType),e=e.timeRange;this.getCollectData(t,a,e,t,"log")}},{key:"render",value:function(){var a=this,t=this.state,e=t.logTypeList,n=t.tableList,i=t.chartLoading,r=t.tableLoading,t=[{title:"Hub状态",dataIndex:"hubStatus",render:function(t){return o.createElement("div",{className:Number(t)===d.b.using.value?f.a[d.b.using.className]:f.a[d.b.stop.className]},o.createElement("span",null))}},{title:"主机IP",dataIndex:"hostIP",render:function(t,e){return o.createElement("span",{onClick:function(){return a.handleShowDetails(e)},className:f.a.showHubDetails},t)}},{title:"插件类型",dataIndex:"pluginType",key:"pluginType"},{title:"插件状态",dataIndex:"pluginStatus",render:function(t,e,a){return(Number(t)==d.d.using.value?d.d.using:d.d.stop).label}},{title:"插件数据消费",dataIndex:"pluginData",render:function(t){return o.createElement(c.a,{percent:100*Number(t),status:"active",format:function(t){return t.toFixed(1)+"%"}})}}];return o.createElement("div",null,o.createElement(y.b,{title:"采集监控"}),o.createElement(y.a,null,o.createElement(s.a,null,o.createElement(u.a,{span:1}),o.createElement(u.a,{className:f.a["col-text"],span:2},"日志类型:"),o.createElement(u.a,{span:3},o.createElement(p.a,{style:{width:150},onChange:function(t){return a.changeLogType(t)}},e.map(function(t,e){return o.createElement(x,{value:t.value,key:e},t.label)}))),o.createElement(u.a,{className:f.a["col-text"],span:2},"插件类型:"),o.createElement(u.a,{span:3},o.createElement(p.a,{style:{width:150},onChange:function(t){return a.changePlugin(t)}},d.e.map(function(t,e){return o.createElement(x,{value:t.value,key:e},t.label)}))),o.createElement(u.a,{className:f.a["col-text"],span:2},"时间类型:"),o.createElement(u.a,{span:3},o.createElement(p.a,{style:{width:150},onChange:function(t){return a.changeTime(t)}},d.f.map(function(t,e){return o.createElement(x,{value:t.value,key:e},t.label)}))),o.createElement(u.a,{span:8})),o.createElement(s.a,{className:f.a["row-column"]},o.createElement(u.a,{span:1}),o.createElement(u.a,{span:22},o.createElement(g.a,{isNotData:!(0<this.state.chartData.xTime.length),loading:i},o.createElement(m.a,{option:this.getOptions()}))),o.createElement(u.a,{span:1})),o.createElement(s.a,{className:f.a["row-table"]},o.createElement(u.a,{span:1}),o.createElement(u.a,{span:22},o.createElement(g.a,{isNotData:!(0<n.length),loading:r},o.createElement(l.a,{columns:t,dataSource:n}))),o.createElement(u.a,{span:1}))))}}]),S);function S(){var t,i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,S);for(var e=arguments.length,a=Array(e),n=0;n<e;n++)a[n]=arguments[n];return(t=i=v(this,(t=S.__proto__||Object.getPrototypeOf(S)).call.apply(t,[this].concat(a)))).state={logTypeList:[],logType:"1",pluginType:"",timeRange:"30M",chartData:{xTime:[],collectList:[],produceList:[],sendList:[],receiveList:[],cp:[],sr:[]},page:1,pageSize:10,totalCount:"",tableList:[],chartLoading:!0,tableLoading:!0},i.getOptions=function(){return{chart:{zoomType:"xy",marginTop:70},title:{text:""},subtitle:{text:"",enabled:!1},xAxis:[{categories:i.state.chartData.xTime,crosshair:!0}],yAxis:[{title:{text:"数据量(k)",align:"high",rotation:0,y:-15,x:5,offset:0},min:0,lineWidth:0},{title:{text:"消费比例",align:"high",rotation:0,y:-15,x:0,offset:0},min:0,max:1,lineWidth:0,opposite:!0}],tooltip:{shared:!0},legend:{enabled:!0,layout:"horizontal",align:"right",verticalAlign:"top"},series:[{name:"日志采集量",type:"column",yAxis:0,data:i.state.chartData.collectList,tooltip:{valueSuffix:"k"}},{name:"日志生产量",type:"column",yAxis:0,data:i.state.chartData.produceList,tooltip:{valueSuffix:"k"}},{name:"日志发送量",type:"column",yAxis:0,data:i.state.chartData.sendList,tooltip:{valueSuffix:"k"}},{name:"日志接收量",type:"column",yAxis:0,data:i.state.chartData.receiveList,tooltip:{valueSuffix:"k"}},{name:"采集量/生产量",type:"line",yAxis:1,data:i.state.chartData.cp,tooltip:{valueSuffix:""}},{name:"发送量/接收量",type:"line",yAxis:1,data:i.state.chartData.sr,tooltip:{valueSuffix:""}}]}},i.handleShowDetails=function(t){var e=i.state,a=e.logType,n=e.timeRange,e=t.hostIP,t=t.pluginType;h.a.helper.renderModal(o.createElement(r.a,{logType:a,timeRange:n,ip:e,pluginType:t}))},v(i,t)}}.call(this,T(1))},988:function(t,m,g){"use strict";!function(a){g.d(m,"a",function(){return f});g(855);var n=g(856),i=(g(506),g(92)),r=(g(507),g(54)),o=g(14),l=g(940),s=g(857),t=g(1),u=g(949),e=function(t,e,a){return e&&c(t.prototype,e),a&&c(t,a),t};function c(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var f=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(h,t.PureComponent),e(h,[{key:"componentDidMount",value:function(){this.showModal()}},{key:"componentDidMount",value:function(){var t=this.props,e=t.logType,a=t.timeRange,n=t.ip,t=t.pluginType;this.getDetail(e,a,n,t)}},{key:"getDetail",value:function(t,e,a,n){var i=this;"sink-agent"==n?this.setState({sendOrConsume:"日志发送量",receiveOrProduce:"日志接收量",percent:"发送量/接收量"}):"source-agent"==n&&this.setState({sendOrConsume:"日志消费量",receiveOrProduce:"日志生产量",percent:"发送量/接收量"}),Object(u.c)(t,e,a,n).then(function(t){i.dataFormat(t.data),i.setState({loading:!1})},function(t){o.a.prompt.error(t.msg)})}},{key:"dataFormat",value:function(t){var n=this,a=t.consumList,t=t.produceList,i=[],r=[],o=[],l=[];a&&a.map(function(t,e){var a=t.time.split(" ")[1].split(":"),a=a[0]+":"+a[1];i.push(a),o.push(Number(n.dataSizeFormat(t.dataSize)))}),t&&t.map(function(t,e){r.push(Number(n.dataSizeFormat(t.dataSize))),l.push(Number((a[e].dataSize/t.dataSize).toFixed(3)))}),this.setState({chartData:{xTime:i,sendList:o,receiveList:r,sr:l}})}},{key:"dataSizeFormat",value:function(t){return 1024<=t&&t<1048576?(this.setState({unit:"K"}),(t/1024).toFixed(3)):1048576<=t&&t<1073742e3?(this.setState({unit:"M"}),(t/1048576).toFixed(3)):1073742e3<=t?(this.setState({unit:"G"}),(t/1073742e3).toFixed(3)):(this.setState({unit:"Bit"}),t)}},{key:"render",value:function(){var t=this.props.hostIP,e=this.state.loading;return a.createElement(n.a,{title:"详情",width:700,visible:this.state.visible,onOk:this.handleOk,onCancel:this.handleCancel,cancelText:"取消",okText:"确定",footer:null},a.createElement(i.a,null,a.createElement(r.a,{span:1}),a.createElement(r.a,{span:2},"主机:"),a.createElement(r.a,{span:20},t),a.createElement(r.a,{span:1})),a.createElement(i.a,null,a.createElement(r.a,{span:1}),a.createElement(r.a,{span:22},a.createElement(s.a,{isNotData:!(0<this.state.chartData.xTime.length),loading:e},a.createElement(l.a,{option:this.getOptions()}))),a.createElement(r.a,{span:1})))}}]),h);function h(){var t,e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h);for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return(t=e=p(this,(t=h.__proto__||Object.getPrototypeOf(h)).call.apply(t,[this].concat(n)))).state={visible:!1,loading:!0,chartData:{xTime:[],sendList:[],receiveList:[],sr:[]},unit:"bit",sendOrConsume:"日志发送量",receiveOrProduce:"日志接收量",percent:"发送量/接收量"},e.showModal=function(){e.setState({visible:!0})},e.handleOk=function(t){e.setState({visible:!1})},e.handleCancel=function(t){e.setState({visible:!1})},e.getOptions=function(){return{chart:{zoomType:"xy",marginTop:70},title:{text:""},subtitle:{text:"",enabled:!1},xAxis:[{categories:e.state.chartData.xTime,crosshair:!0}],yAxis:[{title:{text:"数据量("+e.state.unit+")",align:"high",rotation:0,y:-15,x:5,offset:0},min:0,lineWidth:0},{title:{text:"消费比例",align:"high",rotation:0,y:-15,x:0,offset:0},min:0,max:1,lineWidth:0,opposite:!0}],tooltip:{shared:!0},legend:{enabled:!0,layout:"horizontal",align:"right",verticalAlign:"top"},series:[{name:e.state.sendOrConsume,type:"column",yAxis:0,data:e.state.chartData.sendList,tooltip:{valueSuffix:e.state.unit}},{name:e.state.receiveOrProduce,type:"column",yAxis:0,data:e.state.chartData.receiveList,tooltip:{valueSuffix:e.state.unit}},{name:e.state.percent,type:"line",yAxis:1,data:e.state.chartData.sr,tooltip:{valueSuffix:""}}]}},p(e,t)}}.call(this,g(1))}}]);