(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1245:function(e,t,n){"use strict";n.r(t),function(e){var r=n(309),o=n(1276),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=Object(r.b)(function(e,t){return a({},t)})(o.a);t.default=function(){return e.createElement(i,null)}}.call(this,n(0))},1267:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return a});var r={file:{label:"文件",value:1},dir:{label:"目录",value:2}},o={add:1,edit:2,del:3,upload:4},a={themeKey:"EDITOR_THEME"}},1272:function(e,t,n){"use strict";(function(e){n(605);var r,o,a,i=n(1224),c=(n(143),n(81)),s=(n(69),n(40)),l=(n(1233),n(1259)),u=(n(82),n(45)),p=(n(145),n(14)),f=n(0),m=n(1),d=n.n(m),h=n(7),v=n(167),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var b=h.a.decorator.propTypes({component_id:d.a.number.isRequired,filePath:d.a.string.isRequired,initDevComponentSpaceCb:d.a.func.isRequired})((a=o=function(t){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.saveComponent=function(){var t=e.state.fileList;if(t.length<1)return h.a.prompt.error("请选择要上传的文件"),!1;e.setState({saving:!0},function(){var n,r=e.props,o=r.component_id,a=r.filePath,i=[function(){e.setState({saving:!1,visible:!1}),e.props.initDevComponentSpaceCb(),h.a.prompt.success("上传成功")},function(t){e.setState({saving:!1}),h.a.prompt.error(t.msg)}];(n=Object(v.r)(o,a,t)).then.apply(n,i)})},e.state={saving:!1,visible:!1,fileList:[]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,f["PureComponent"]),y(n,[{key:"componentDidMount",value:function(){this.setState({visible:!0})}},{key:"render",value:function(){var t=this,n=this.state,r=n.saving,o=n.visible,a={multiple:!0,onRemove:function(e){t.setState(function(t){var n=t.fileList,r=n.indexOf(e),o=n.slice();return o.splice(r,1),{fileList:o}})},beforeUpload:function(e){return t.setState(function(t){var n=t.fileList;return{fileList:[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n),[e])}}),!1},fileList:this.state.fileList};return e.createElement(i.a,{title:"上传文件",visible:o,onCancel:function(){return t.setState({visible:!1})},footer:[e.createElement(u.a,{key:"back",onClick:function(){return t.setState({visible:!1})}},"取消"),e.createElement(u.a,{key:"submit",type:"primary",loading:r,onClick:this.saveComponent},"确定")]},e.createElement(c.a,{type:"flex",align:"middle",justify:"center"},e.createElement(s.a,{span:6},e.createElement(l.a,a,e.createElement(u.a,null,e.createElement(p.a,{type:"upload"})," 选择文件")))))}}]),n}(),o.defaultProps={component_id:!1,initDevComponentSpaceCb:function(){}},r=a))||r;t.a=b}).call(this,n(0))},1273:function(e,t,n){"use strict";(function(e){n(605);var r,o=n(1224),a=(n(143),n(81)),i=(n(69),n(40)),c=(n(144),n(111)),s=(n(223),n(303)),l=n(0),u=n(1),p=n.n(u),f=n(7),m=n(1267),d=n(167),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var v=f.a.decorator.propTypes({component_id:p.a.number.isRequired,operateType:p.a.number.isRequired,filePath:p.a.string.isRequired,initDevComponentSpaceCb:p.a.func.isRequired})(r=function(t){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.showModal=function(){t.setState({visible:!0}),t.nameInput&&t.nameInput.focus()},t.handleOk=function(e){var n=t.props,r=n.component_id,o=n.filePath,a=n.operateType,i=n.initDevComponentSpaceCb,c=t.state,s=c.name,l=c.fileOrDirMark;t.setState({saving:!0},function(){switch(a){case m.c.add:return Object(d.c)(r,o,s,l).then(function(){f.a.prompt.success("操作成功"),i(),t.setState({visible:!1,saving:!1})},function(e){f.a.prompt.error(e.msg),t.setState({saving:!1})});case m.c.edit:return Object(d.q)(r,o,s).then(function(){f.a.prompt.success("操作成功"),i(),t.setState({visible:!1,saving:!1})},function(e){f.a.prompt.error(e.msg),t.setState({saving:!1})});case m.c.del:}})},t.handleCancel=function(e){return t.setState({visible:!1})},t.nameInput=null,t.state={visible:!1,saving:!1,name:e.name||null,fileOrDirMark:m.b.file.value},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,l["PureComponent"]),h(n,[{key:"componentDidMount",value:function(){this.showModal()}},{key:"render",value:function(){var t=this,n=this.state,r=n.visible,l=n.saving,u=n.name,p=n.fileOrDirMark,f=this.props.operateType,d={marginBottom:5};return e.createElement(o.a,{title:"添加文件或目录",visible:r,confirmLoading:l,onOk:this.handleOk,onCancel:this.handleCancel,okText:"确定",cancelText:"取消"},e.createElement(a.a,{type:"flex",align:"middle",style:d},e.createElement(i.a,{span:4,offset:4},e.createElement("span",null,"名称:")),e.createElement(i.a,{span:10},e.createElement(s.a,{value:u,onKeyDown:function(e){return 13==e.keyCode?t.handleOk():null},onChange:function(e){return t.setState({name:e.target.value.trim()})}}))),f==m.c.add?e.createElement(a.a,{type:"flex",align:"middle",style:d},e.createElement(i.a,{span:4,offset:4},e.createElement("span",null,"文件类型:")),e.createElement(i.a,{span:10},e.createElement(c.a,{value:p,onChange:function(e){return t.setState({fileOrDirMark:e})},style:{width:"100%"}},Object.values(m.b).map(function(t){return e.createElement(c.a.Option,{key:t.value,value:t.value},t.label)})))):null)}}]),n}())||r;t.a=v}).call(this,n(0))},1274:function(e,t,n){"use strict";(function(e){n(145);var r,o=n(14),a=(n(1243),n(1261)),i=n(0),c=(n(308),n(1273)),s=n(1272),l=n(1),u=n.n(l),p=n(7),f=n(167),m=n(1267),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();a.a.TreeNode;var v=p.a.decorator.propTypes({component_id:u.a.oneOfType([u.a.number,u.a.string]).isRequired,style:u.a.object,selectedKeys:u.a.arrayOf(u.a.string)})(r=function(t){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.onSelect=function(t,n){var r=e.props,o=r.component_id,a=r.setFileContentFn,i=n.node.props.data,c=i.key;i.isFile?Object(f.n)(o,c).then(function(e){return a(c,e.data,t)},function(e){return p.a.prompt.error(e.msg)}):a(null,null,t)},e.state={data:[],loading:!1},e.firstInitDevComponentSpace=!0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,i["PureComponent"]),h(n,[{key:"componentDidMount",value:function(){this.initDevComponentSpace()}},{key:"onOperate",value:function(t,n){var r=this,o=this.props.component_id,a=n.key,i=this.props,l=i.selectedKeys,u=i.setFileContentFn;t==m.c.del?p.a.prompt.confirm(function(){return Object(f.g)(o,a).then(function(){p.a.prompt.success("操作成功"),r.initDevComponentSpace(),u(a,null,l.filter(function(e){return e!==a}))},function(e){p.a.prompt.error(e.msg)})},{title:"确定删除？"}):t==m.c.upload?p.a.helper.renderModal(e.createElement(s.a,{filePath:a,component_id:parseInt(o),initDevComponentSpaceCb:function(){return r.initDevComponentSpace()}})):p.a.helper.renderModal(e.createElement(c.a,{operateType:t,filePath:a,component_id:parseInt(o),name:t==m.c.edit?n.title:null,initDevComponentSpaceCb:function(){return r.initDevComponentSpace()}}))}},{key:"initDevComponentSpace",value:function(){var e=this,t=this.props.component_id;this.setState({loading:!0},function(){Object(f.l)(t).then(function(t){e.firstInitDevComponentSpace&&(e.firstInitDevComponentSpace=!1,e.props.refreshViewIframe&&e.props.refreshViewIframe()),e.setState({loading:!1,data:[t.data]})},function(t){p.a.prompt.error(t.msg),e.setState({loading:!1})})})}},{key:"render",value:function(){var t=this.state,n=t.data;t.loading,this.props.selectedKeys,n.length>0&&n[0]&&n[0].children&&n[0].children.find(function(e){return"src"===e.title});return e.createElement("div",null)}}]),n}())||r;t.a=v;var y={marginLeft:5},b=d({},y,{color:"red"}),g=function(t){var n=t.title,r=t.isFile,a=t.onOperate,i=function(e,t){e.stopPropagation(),a(t)};return e.createElement("div",{className:"tree-item-header"},e.createElement("div",{className:"name"},n),e.createElement("div",{className:"btn"},e.createElement("div",null,r?null:e.createElement(o.a,{type:"plus",onClick:function(e){return i(e,m.c.add)}}),r?null:e.createElement(o.a,{type:"upload",onClick:function(e){return i(e,m.c.upload)},style:{marginLeft:5}}),e.createElement(o.a,{type:"edit",onClick:function(e){return i(e,m.c.edit)},style:y}),e.createElement(o.a,{type:"delete",onClick:function(e){return i(e,m.c.del)},style:b}))))};g.propTypes={title:u.a.string.isRequired,isFile:u.a.bool.isRequired,onOperate:u.a.func.isRequired}}).call(this,n(0))},1275:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return w});n(1234);var r,o=n(1263),a=(n(143),n(81)),i=(n(82),n(45)),c=(n(605),n(1224)),s=n(0),l=n(23),u=n(221),p=n(167),f=n(1274),m=n(1242),d=n.n(m),h=n(1),v=n.n(h),y=n(7),b=n(1267),g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var E="您尚有文件内容未保存, 是否离开?",_=function(){switch((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(".").pop()){case"js":case"jsx":return"javascript";case"json":return"json";case"css":return"css";case"scss":return"scss";case"less":return"less";case"html":return"html";case"xml":return"xml";case"ts":case"tsx":return"typescript";default:return"javascript"}},k=["vs","vs-dark"],w=y.a.decorator.propTypes({component_id:v.a.number.isRequired,codeCompileStatusCb:v.a.func.isRequired})(r=function(t){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.codeCompileCallback=function(t){if(t.origin===window.ENV.coderDomain&&t.data&&"codeCompile"===t.data.method){var n=e.props.codeCompileStatusCb;switch(n(!1),t.data.action){case"prepare":y.a.prompt.success("保存成功, 开始编译..."),e.isCompilation=!0,n(!0);break;case"success":y.a.prompt.success("编译成功"),e.isCompilation=!1,n(!1);break;case"fail":y.a.prompt.error("编译失败！"),e.isCompilation=!1,n(!1)}}},e.pageBeforeunloadCallback=function(t){var n=e.state,r=n.code,o=n.editCode;e.currentEditFilePath&&r!==o&&(t.preventDefault(),t.returnValue=E)},e.checkSaveStatus=function(){return new Promise(function(t){var n=e.state,r=n.code,o=n.editCode;e.currentEditFilePath&&r!==o?c.a.confirm({title:"提示",content:E,onCancel:function(){return t(!1)},onOk:function(){return t(!0)}}):t(!0)})},e.onEditorChange=function(t){e.setState({editCode:t})},e.editorThemeChange=function(t){var n=k[Number(t)];e.setState({editorTheme:n},function(){e.setEditorTheme(n)})},e.getEditorTheme=function(){return y.a.storage.getStorage(b.a.themeKey)||k[0]},e.setEditorTheme=function(e){y.a.storage.setStorage(b.a.themeKey,e)},e.currentEditFilePath=null,e.isCompilation=null,e.state={code:"",editCode:"",language:_(),isCollapseEditor:!1,npmInstalling:!1,selectedKeys:[],editorTheme:k[0]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,s["PureComponent"]),C(n,[{key:"editorDidMount",value:function(e,t){e.focus(),this.initKeyboard(e,t)}},{key:"componentDidMount",value:function(){var e=this.getEditorTheme();this.setState({editorTheme:e}),window.addEventListener("beforeunload",this.pageBeforeunloadCallback),window.addEventListener("message",this.codeCompileCallback,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.pageBeforeunloadCallback),window.removeEventListener("message",this.codeCompileCallback,!1)}},{key:"setFileContent",value:function(e,t,n){var r=this;e?this.checkSaveStatus().then(function(o){if(o){var a={code:"",editCode:"",language:_()};"string"!=typeof t?r.currentEditFilePath=null:(r.currentEditFilePath=e,a={code:t,editCode:t,language:_(e)}),r.setState(g({},a,{selectedKeys:n}))}}):this.setState({selectedKeys:n})}},{key:"initKeyboard",value:function(e,t){var n=this,r=this.props,o=r.component_id,a=r.codeCompileStatusCb;e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.KEY_S,function(){n.currentEditFilePath&&Object(p.o)(o,n.currentEditFilePath,e.getValue()).then(function(){y.a.prompt.success("保存成功"),n.setState({code:n.state.editCode}),(n.currentEditFilePath.match(/\.jsx?$/)||n.currentEditFilePath.match(/\.less$/)||n.currentEditFilePath.match(/\.css$/))&&!n.isCompilation&&(n.isCompilation=!0,a(!0),Object(p.d)(o).then(function(){n.isCompilation=!1,a(!1),y.a.prompt.success("编译完成")},function(e){n.isCompilation=!1,a(!1,e.msg),y.a.prompt.error(e.msg)}))},function(e){n.isCompilation=!1,a(!1),y.a.prompt.error(e.msg)})})}},{key:"npmInstallDevComponent",value:function(e){var t=this;y.a.prompt.confirm(function(){t.setState({npmInstalling:!0},function(){Object(p.m)(e).then(function(){t.setState({npmInstalling:!1}),y.a.prompt.success("npm install 安装依赖包完成")},function(e){t.setState({npmInstalling:!1}),y.a.prompt.error(e.msg)})})},{title:"确定安装依赖？"})}},{key:"render",value:function(){var t=this,n=(y.a.auth.getLoginInfo()||{}).user,r=this.props,c=r.component_id,s=r.component_mark,p=r.org_mark,m=this.state.npmInstalling,h=window.ENV.coderDomain+"/?component_id="+c+"&user_id="+n.user_id+"&folder=/resources/flyFish/visual_component_platform_server/www/static/dev_visual_component/dev_workspace/"+p+"/"+s;return e.createElement("div",{className:d.a.code_editor},e.createElement(o.a,{title:"编辑区",className:"editor-card",bodyStyle:{padding:0},style:{marginBottom:10},extra:[e.createElement(i.a,{key:1,type:"primary",style:{margin:"0 5px"},loading:m,onClick:function(){return t.npmInstallDevComponent(c)}},e.createElement("span",null,"安装依赖")),e.createElement(u.a,{key:2,to:{pathname:l.a.v_component_change_list,search:"?component_id="+c}},e.createElement(i.a,{icon:"code-o",type:"primary"},e.createElement("span",null,"组件记录")))]},e.createElement(a.a,null,e.createElement(f.a,{component_id:c}),e.createElement("div",{className:d.a.code_editor},e.createElement("iframe",{id:"child",src:h,width:"100%",height:"600"})))))}}]),n}())||r}).call(this,n(0))},1276:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return b});n(1234);var r,o=n(1263),a=(n(143),n(81)),i=(n(69),n(40)),c=(n(82),n(45)),s=n(1244),l=n.n(s),u=n(7),p=n(308),f=n(1275),m=n(0),d=n(310),h=n(167),v=n(224),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var b=u.a.decorator.contextTypes("router")(r=function(t){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.codeCompileStatusCb=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.setState({isCompilation:t,compilationErrorInfo:n})},e.state={loading:!1,org_mark:null,component_mark:null,isCompilation:!1,compilationErrorInfo:null},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,m["Component"]),y(n,[{key:"componentDidMount",value:function(){var e=this,t=this.getComponentId();this.setState({loading:!0},function(){Object(h.j)(t).then(function(t){Object(v.e)(t.data.org_id).then(function(n){e.setState({loading:!1,component_mark:t.data.component_mark,org_mark:n.data.org_mark})},function(e){return u.a.prompt.error(e.msg)})},function(e){return u.a.prompt.error(e.msg)})})}},{key:"getComponentId",value:function(){return u.a.queryString.parse(this.context.router.route.location.search).component_id}},{key:"render",value:function(){var t=this,n=this.getComponentId(),r=this.state,s=r.isCompilation,u=r.compilationErrorInfo;return e.createElement("div",{className:l.a["v-component-create"]},e.createElement(d.b,{title:"组件创建",rightRender:e.createElement(c.a,{type:"primary",icon:"rollback",onClick:function(){return t.context&&t.context.router&&t.context.router.history&&t.context.router.history.goBack()}},"返回")}),e.createElement(d.a,null,e.createElement(p.a,{loading:this.state.loading},e.createElement(f.a,{component_id:parseInt(n),component_mark:this.state.component_mark,org_mark:this.state.org_mark,codeCompileStatusCb:this.codeCompileStatusCb}),e.createElement(o.a,{title:"可视化区",bodyStyle:{padding:0}},e.createElement(a.a,{gutter:16},e.createElement(i.a,{span:24},e.createElement(p.a,{loading:s},u?e.createElement("span",{style:{color:"#ff6666"}},u):e.createElement("iframe",{id:"iframe-screen",src:window.ENV.visualComponent.getDevVisualUrl(this.state.org_mark,this.state.component_mark),style:{width:"100%",height:"800px",border:0}}))))))))}}]),n}())||r}).call(this,n(0))}}]);