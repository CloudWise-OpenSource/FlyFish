!function(C,Z,p){"use strict";function v(W,D){this.position=W,this.$22n=D}var c="ht",g=C[c],I=null,Y=Math,k=Y.PI,L=Y.cos,M=Y.sin,G=Y.abs,W=Y.max,d=Y.sqrt,F=1e-5,_=g.Default,X=_.def,q=_.startAnim,r=_.createMatrix,A=_.transformVec,f=_.getInternal(),x=f.addMethod,H=f.superCall,z=f.toPointsArray,$=f.createNormals,o=f.toFloatArray,J=f.glMV,R=(f.glPop,g.graph3d.Graph3dView,g.Math),y=R.Vector3,l=R.Matrix4,n=R.Euler,w=(R.Quaternion,f.batchShape),u=f.createNodeMatrix,O=f.getFaceInfo,P=f.transformAppend,S=f.drawFaceInfo,e=f.createAnim,i=f.cube(),V=i.is,t=i.vs,N=i.uv,B=f.ui(),s=g.Node,a=g.Shape,E="h",D="v",Q="front",K="back",T="left",h="right",m="top",j="bottom",U="dw.expanded",b=".expanded",Ah="dw.angle",Hl=".angle",Tg=function(J,w,Y){X(c+"."+J,w,Y)},eq=function(J,x,P){P?J.push(x.x,x.y):J.push(x.x,x.y,x.z)},tl=function(){var F=new g.Math.Vector3,P=new g.Math.Vector3,X=new g.Math.Vector3;return function(e,Q,i,B,W){if(F.copy(Q.$24n),P.copy(i.$24n),X.copy(B.$24n),!(X.equals(F)||P.equals(F)||P.equals(X))){if(!Q.$22n||!i.$22n||!B.$22n){var w=P.sub(F).cross(X.sub(F)).normalize().multiplyScalar(1).toArray();Q.$22n||(Q.$22n=new Xo(w)),i.$22n||(i.$22n=new Xo(w)),B.$22n||(B.$22n=new Xo(w))}e.push(new Wp([Q,i,B],W))}}}(),cg=function(H,M,J,q){var N,m,x,E,T=0,_=[];if(q)for(N=q.length;N>T;T+=3)m=q[T],x=q[T+1],E=q[T+2],tl(_,new Bf([M[3*m],M[3*m+1],M[3*m+2]],null,J?[J[2*m],J[2*m+1],0]:I),new Bf([M[3*x],M[3*x+1],M[3*x+2]],null,J?[J[2*x],J[2*x+1],0]:I),new Bf([M[3*E],M[3*E+1],M[3*E+2]],null,J?[J[2*E],J[2*E+1],0]:I),H);else for(N=M.length/3;N>T;T+=3)m=T,x=T+1,E=T+2,tl(_,new Bf([M[3*m],M[3*m+1],M[3*m+2]],null,J?[J[2*m],J[2*m+1],0]:I),new Bf([M[3*x],M[3*x+1],M[3*x+2]],null,J?[J[2*x],J[2*x+1],0]:I),new Bf([M[3*E],M[3*E+1],M[3*E+2]],null,J?[J[2*E],J[2*E+1],0]:I),H);return _},Ud=[T,Q,h,K,m,j],Ap=["",m,j],yd=Ud.concat("csg"),$i=[0,6,12,18,24,30],qj=function(W,e,X){var o=u(W),D=[];W.appendAnchorMatrix3d(o);var U,_=e?e.getData3dUI(W):null;if(_&&_.s("shape3d")&&!_.s("csg.cull.box")&&(U=_.shapeModel,_.shapeModel||(U=f.getShapeModel(_,_.s("shape3d"))),U))for(var B=f.createNormalMatrix(o),y=0,n=Ap.length;n>y;y++){var s=Ap[y],$=s.length?s+"_":s,E=U[$+"vs"],O=U[$+"uv"],d=U[$+"is"],R=U[$+"ns"];if(E&&E.length)for(var C,h,j,Z=0,p=d?d.length:E.length/3;p>Z;Z+=3)d?(C=d[Z],h=d[Z+1],j=d[Z+2]):(C=Z,h=Z+1,j=Z+2),tl(D,new Bf(A([E[3*C],E[3*C+1],E[3*C+2]],o),R?A([R[3*C],R[3*C+1],R[3*C+2]],B):null,[O[2*C],O[2*C+1],0]),new Bf(A([E[3*h],E[3*h+1],E[3*h+2]],o),R?A([R[3*h],R[3*h+1],R[3*h+2]],B):null,[O[2*h],O[2*h+1],0]),new Bf(A([E[3*j],E[3*j+1],E[3*j+2]],o),R?A([R[3*j],R[3*j+1],R[3*j+2]],B):null,[O[2*j],O[2*j+1],0]),W)}if(!U)for(var y=0;6>y;y++)for(var s=Ud[y],w=$i[y],O=X?e.getFaceUv(W,s):I,M=X?e.getFaceUvScale(W,s):I,Y=X?e.getFaceUvOffset(W,s):I,m=0;2>m;m++){var K,S,c,J=V[w+3*m],q=V[w+3*m+1],x=V[w+3*m+2];if(X){if(O){var b=8*y;K=[O[2*J-b],O[2*J+1-b],0],S=[O[2*q-b],O[2*q+1-b],0],c=[O[2*x-b],O[2*x+1-b],0]}else K=[N[2*J],N[2*J+1],0],S=[N[2*q],N[2*q+1],0],c=[N[2*x],N[2*x+1],0];M&&(K[0]*=M[0],K[1]*=M[1],S[0]*=M[0],S[1]*=M[1],c[0]*=M[0],c[1]*=M[1]),Y&&(K[0]+=Y[0],K[1]+=Y[1],S[0]+=Y[0],S[1]+=Y[1],c[0]+=Y[0],c[1]+=Y[1])}tl(D,new Bf(A([t[3*J],t[3*J+1],t[3*J+2]],o),null,K),new Bf(A([t[3*q],t[3*q+1],t[3*q+2]],o),null,S),new Bf(A([t[3*x],t[3*x+1],t[3*x+2]],o),null,c),W)}return ah.$15n(D)},il=function(X,R){var W,Q=X.data.getAttaches();if(Q&&Q.each(function(I){I instanceof oq&&I.s("attach.operation")&&(W||(W=[]),W.push(I))}),W){var J;Ud.forEach(function(O){var N=cg(O,X[O].vs,X[O].tuv);J=J?J.concat(N):N}),J=ah.$15n(J),W.forEach(function(P){var T=P.s("attach.operation");J[T]&&(J=J[T](qj(P,X.gv,X.csg.tuv)))}),Ud.forEach(function(b){b=X[b],b.vs=[],b.ns=[],b.tuv&&(b.tuv=[])}),X.csg&&!X.csg.ns&&(X.csg.ns=[]);var j=[];if(J.$19n().forEach(function(N){var l,x=N.$10n;if(x instanceof oq){if(x.s("attach.cull"))return;l=x.s("csg.cull.color"),l&&(l=f.toColorArray(l)),x="csg"}for(var _=X[x],p=_.vs,J=_.ns,r=_.tuv,Y=N.$9n,L=2;L<Y.length;L++)if(eq(p,Y[0].$24n),eq(p,Y[L-1].$24n),eq(p,Y[L].$24n),J&&(eq(J,Y[0].$22n),eq(J,Y[L-1].$22n),eq(J,Y[L].$22n)),r&&(eq(r,Y[0].uv,!0),eq(r,Y[L-1].uv,!0),eq(r,Y[L].uv,!0)),l)for(var D=4*(p.length/3),T=0;3>T;T++)j[--D]=l[3],j[--D]=l[2],j[--D]=l[1],j[--D]=l[0]}),j.length){for(var x=f.toColorArray(X.csg.color),y=0,q=4*(X.csg.vs.length/3);q>y;y+=4)j[y]==p&&(j[y]=x[0],j[y+1]=x[1],j[y+2]=x[2],j[y+3]=x[3]);X.csg.cs=j}}yd.forEach(function(S){var W=X[S];W.visible&&W.vs.length?(W.ns&&W.ns.length?o(W,"ns"):W.ns=$(W.vs),o(W,"vs"),o(W,"tuv"),W.cs&&o(W,"cs")):delete X[S]}),R&&(w(X,I,R),X.clear())};x(_,{createFrameModel:function(K,H,k,n){K=K==I?.07:K,H=H==I?K:H,k=k==I?K:k,n=n?n:{};var C=n.top,L=n.bottom,D=n.left,W=n.right,X=n.front,b=n.back,N=[],w=[];return X===!0?(N.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),w.push(0,0,0,1,1,1,1,1,1,0,0,0)):X===!1||(N.push(-.5,.5,.5,-.5,-.5,.5,-.5+K,-.5,.5,-.5+K,-.5,.5,-.5+K,.5,.5,-.5,.5,.5,.5-K,.5,.5,.5-K,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-K,.5,.5,-.5+K,.5,.5,-.5+K,.5-H,.5,.5-K,.5-H,.5,.5-K,.5-H,.5,.5-K,.5,.5,-.5+K,.5,.5,-.5+K,-.5+H,.5,-.5+K,-.5,.5,.5-K,-.5,.5,.5-K,-.5,.5,.5-K,-.5+H,.5,-.5+K,-.5+H,.5),w.push(0,0,0,1,K,1,K,1,K,0,0,0,1-K,0,1-K,1,1,1,1,1,1,0,1-K,0,K,0,K,H,1-K,H,1-K,H,1-K,0,K,0,K,1-H,K,1,1-K,1,1-K,1,1-K,1-H,K,1-H)),b===!0?(N.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),w.push(1,0,0,1,1,1,0,1,1,0,0,0)):b===!1||(N.push(-.5,.5,-.5,-.5+K,-.5,-.5,-.5,-.5,-.5,-.5+K,-.5,-.5,-.5,.5,-.5,-.5+K,.5,-.5,.5-K,.5,-.5,.5,-.5,-.5,.5-K,-.5,-.5,.5,-.5,-.5,.5-K,.5,-.5,.5,.5,-.5,-.5+K,.5,-.5,.5-K,.5-H,-.5,-.5+K,.5-H,-.5,.5-K,.5-H,-.5,-.5+K,.5,-.5,.5-K,.5,-.5,-.5+K,-.5+H,-.5,.5-K,-.5,-.5,-.5+K,-.5,-.5,.5-K,-.5,-.5,-.5+K,-.5+H,-.5,.5-K,-.5+H,-.5),w.push(1,0,1-K,1,1,1,1-K,1,1,0,1-K,0,K,0,0,1,K,1,0,1,K,0,0,0,1-K,0,K,H,1-K,H,K,H,1-K,0,K,0,1-K,1-H,K,1,1-K,1,K,1,1-K,1-H,K,1-H)),D===!0?(N.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),w.push(0,0,0,1,1,1,1,1,1,0,0,0)):D===!1||(N.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+k,-.5,-.5,-.5+k,-.5,.5,-.5+k,-.5,.5,-.5,-.5,.5,.5-k,-.5,-.5,.5-k,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-k,-.5,.5,-.5+k,-.5,.5-H,-.5+k,-.5,.5-H,.5-k,-.5,.5-H,.5-k,-.5,.5,.5-k,-.5,.5,-.5+k,-.5,-.5+H,-.5+k,-.5,-.5,-.5+k,-.5,-.5,.5-k,-.5,-.5,.5-k,-.5,-.5+H,.5-k,-.5,-.5+H,-.5+k),w.push(0,0,0,1,k,1,k,1,k,0,0,0,1-k,0,1-k,1,1,1,1,1,1,0,1-k,0,k,0,k,H,1-k,H,1-k,H,1-k,0,k,0,k,1-H,k,1,1-k,1,1-k,1,1-k,1-H,k,1-H)),W===!0?(N.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),w.push(1,0,0,1,1,1,0,1,1,0,0,0)):W===!1||(N.push(.5,.5,-.5,.5,-.5,-.5+k,.5,-.5,-.5,.5,-.5,-.5+k,.5,.5,-.5,.5,.5,-.5+k,.5,.5,.5-k,.5,-.5,.5,.5,-.5,.5-k,.5,-.5,.5,.5,.5,.5-k,.5,.5,.5,.5,.5,-.5+k,.5,.5-H,.5-k,.5,.5-H,-.5+k,.5,.5-H,.5-k,.5,.5,-.5+k,.5,.5,.5-k,.5,-.5+H,-.5+k,.5,-.5,.5-k,.5,-.5,-.5+k,.5,-.5,.5-k,.5,-.5+H,-.5+k,.5,-.5+H,.5-k),w.push(1,0,1-k,1,1,1,1-k,1,1,0,1-k,0,k,0,0,1,k,1,0,1,k,0,0,0,1-k,0,k,H,1-k,H,k,H,1-k,0,k,0,1-k,1-H,k,1,1-k,1,k,1,1-k,1-H,k,1-H)),C===!0?(N.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),w.push(1,1,1,0,0,0,0,0,0,1,1,1)):C===!1||(N.push(.5,.5,.5,.5,.5,-.5,.5-K,.5,-.5,.5-K,.5,-.5,.5-K,.5,.5,.5,.5,.5,-.5+K,.5,.5,-.5+K,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+K,.5,.5,.5-K,.5,.5,.5-K,.5,.5-k,-.5+K,.5,.5-k,-.5+K,.5,.5-k,-.5+K,.5,.5,.5-K,.5,.5,.5-K,.5,-.5+k,.5-K,.5,-.5,-.5+K,.5,-.5,-.5+K,.5,-.5,-.5+K,.5,-.5+k,.5-K,.5,-.5+k),w.push(1,1,1,0,1-K,0,1-K,0,1-K,1,1,1,K,1,K,0,0,0,0,0,0,1,K,1,1-K,1,1-K,1-k,K,1-k,K,1-k,K,1,1-K,1,1-K,k,1-K,0,K,0,K,0,K,k,1-K,k)),L===!0?(N.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),w.push(1,0,0,1,1,1,0,1,1,0,0,0)):L===!1||(N.push(.5,-.5,.5,.5-K,-.5,-.5,.5,-.5,-.5,.5-K,-.5,-.5,.5,-.5,.5,.5-K,-.5,.5,-.5+K,-.5,.5,-.5,-.5,-.5,-.5+K,-.5,-.5,-.5,-.5,-.5,-.5+K,-.5,.5,-.5,-.5,.5,.5-K,-.5,.5,-.5+K,-.5,.5-k,.5-K,-.5,.5-k,-.5+K,-.5,.5-k,.5-K,-.5,.5,-.5+K,-.5,.5,.5-K,-.5,-.5+k,-.5+K,-.5,-.5,.5-K,-.5,-.5,-.5+K,-.5,-.5,.5-K,-.5,-.5+k,-.5+K,-.5,-.5+k),w.push(1,0,1-K,1,1,1,1-K,1,1,0,1-K,0,K,0,0,1,K,1,0,1,K,0,0,0,1-K,0,K,k,1-K,k,K,k,1-K,0,K,0,1-K,1-k,K,1,1-K,1,K,1,1-K,1-k,K,1-k)),{vs:N,uv:w}}}),x(g.Style,{"csg.cull.color":p,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":p,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":k/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),Ud.forEach(function(h){var d={};d[h+b]=!1,d[h+".toggleable"]=!1,d[h+".axis"]=T,d[h+".start"]=0,d[h+".end"]=k/2,d[h+Hl]=0,x(g.Style,d,!0)});var ah=function(){this.$4n=[]};ah.$15n=function(C){var s=new ah;return s.$4n=C,s},ah.prototype={clone:function(){var Q=new ah;return Q.$4n=this.$4n.map(function(n){return n.clone()}),Q},$19n:function(){return this.$4n},union:function(C){var r=new Qq(this.clone().$4n),Y=new Qq(C.clone().$4n);return r.$3n(Y),Y.$3n(r),Y.$6n(),Y.$3n(r),Y.$6n(),r.$7n(Y.$2n()),ah.$15n(r.$2n())},subtract:function(u){var f=new Qq(this.clone().$4n),c=new Qq(u.clone().$4n);return f.$6n(),f.$3n(c),c.$3n(f),c.$6n(),c.$3n(f),c.$6n(),f.$7n(c.$2n()),f.$6n(),ah.$15n(f.$2n())},intersect:function(x){var o=new Qq(this.clone().$4n),M=new Qq(x.clone().$4n);return o.$6n(),M.$3n(o),M.$6n(),o.$3n(M),M.$3n(o),o.$7n(M.$2n()),o.$6n(),ah.$15n(o.$2n())},inverse:function(){var S=this.clone();return S.$4n.map(function(p){p.flip()}),S}},ah.cube=function(k){k=k||{};var D=new Xo(k.center||[0,0,0]),O=k.radius?k.radius.length?k.radius:[k.radius,k.radius,k.radius]:[1,1,1];return ah.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(w){return new Wp(w[0].map(function(J){var E=new Xo(D.x+O[0]*(2*!!(1&J)-1),D.y+O[1]*(2*!!(2&J)-1),D.z+O[2]*(2*!!(4&J)-1));return new Bf(E,new Xo(w[1]))}))}))},ah.sphere=function(d){function n(n,p){n*=2*k,p*=k;var B=new Xo(L(n)*M(p),L(p),M(n)*M(p));F.push(new Bf(I.$20n(B.$21n($)),B))}d=d||{};for(var F,I=new Xo(d.center||[0,0,0]),$=d.radius||1,c=d.slices||16,u=d.stacks||8,K=[],o=0;c>o;o++)for(var r=0;u>r;r++)F=[],n(o/c,r/u),r>0&&n((o+1)/c,r/u),u-1>r&&n((o+1)/c,(r+1)/u),n(o/c,(r+1)/u),K.push(new Wp(F));return ah.$15n(K)},ah.cylinder=function(T){function s(f,j,H){var x=2*j*k,r=y.$21n(L(x)).$20n(t.$21n(M(x))),K=p.$20n(V.$21n(f)).$20n(r.$21n(N)),b=r.$21n(1-G(H)).$20n(e.$21n(H));return new Bf(K,b)}T=T||{};for(var p=new Xo(T.start||[0,-1,0]),d=new Xo(T.end||[0,1,0]),V=d.$13n(p),N=T.radius||1,H=T.slices||16,e=V.$14n(),J=G(e.y)>.5,y=new Xo(J,!J,0).cross(e).$14n(),t=y.cross(e).$14n(),S=new Bf(p,e.$11n()),R=new Bf(d,e.$14n()),u=[],Z=0;H>Z;Z++){var w=Z/H,C=(Z+1)/H;u.push(new Wp([S,s(0,w,-1),s(0,C,-1)])),u.push(new Wp([s(0,C,0),s(0,w,0),s(1,w,0),s(1,C,0)])),u.push(new Wp([R,s(1,C,1),s(1,w,1)]))}return ah.$15n(u)};var Xo=function(c,L,w){var t=this;3==arguments.length?(t.x=c,t.y=L,t.z=w):"x"in c?(t.x=c.x,t.y=c.y,t.z=c.z):(t.x=c[0],t.y=c[1],t.z=c[2])};Xo.prototype={clone:function(){return new Xo(this.x,this.y,this.z)},$11n:function(){return new Xo(-this.x,-this.y,-this.z)},$20n:function(R){return new Xo(this.x+R.x,this.y+R.y,this.z+R.z)},$13n:function(F){return new Xo(this.x-F.x,this.y-F.y,this.z-F.z)},$21n:function(M){return new Xo(this.x*M,this.y*M,this.z*M)},$16n:function(v){return new Xo(this.x/v,this.y/v,this.z/v)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lerp:function(s,e){return this.$20n(s.$13n(this).$21n(e))},length:function(){return d(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(U){var c=this;return new Xo(c.y*U.z-c.z*U.y,c.z*U.x-c.x*U.z,c.x*U.y-c.y*U.x)}};var Bf=function(l,A,C){var H=this;H.$24n=new Xo(l),H.$22n=A?new Xo(A):null,H.uv=C?new Xo(C):null};Bf.prototype={clone:function(){var A=this;return new Bf(A.$24n.clone(),A.$22n.clone(),A.uv?A.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(o,S){var s=this;return new Bf(s.$24n.lerp(o.$24n,S),s.$22n.lerp(o.$22n,S),s.uv?s.uv.lerp(o.uv,S):null)}};var gn=function(M,Z){this.$22n=M,this.w=Z};gn.$17n=function(f,H,y){var S=H.$13n(f).cross(y.$13n(f)).$14n();return new gn(S,S.dot(f))},gn.prototype={clone:function(){return new gn(this.$22n.clone(),this.w)},flip:function(){var X=this;X.$22n=X.$22n.$11n(),X.w=-X.w},$5n:function(I,Z,T,H,h){for(var c=this,X=0,u=1,Y=2,A=3,j=0,g=[],L=0;L<I.$9n.length;L++){var p=c.$22n.dot(I.$9n[L].$24n)-c.w,D=-F>p?Y:p>F?u:X;j|=D,g.push(D)}switch(j){case X:(c.$22n.dot(I.$8n.$22n)>0?Z:T).push(I);break;case u:H.push(I);break;case Y:h.push(I);break;case A:for(var l=[],z=[],L=0;L<I.$9n.length;L++){var C=(L+1)%I.$9n.length,q=g[L],v=g[C],W=I.$9n[L],K=I.$9n[C];if(q!=Y&&l.push(W),q!=u&&z.push(q!=Y?W.clone():W),(q|v)==A){var p=(c.w-this.$22n.dot(W.$24n))/c.$22n.dot(K.$24n.$13n(W.$24n)),i=W.$18n(K,p);l.push(i),z.push(i.clone())}}l.length>=3&&H.push(new Wp(l,I.$10n)),z.length>=3&&h.push(new Wp(z,I.$10n))}}};var Wp=function(G,O){var z=this;z.$9n=G,z.$10n=O,z.$8n=gn.$17n(G[0].$24n,G[1].$24n,G[2].$24n)};Wp.prototype={clone:function(){var I=this.$9n.map(function(y){return y.clone()});return new Wp(I,this.$10n)},flip:function(){this.$9n.reverse().map(function(x){x.flip()}),this.$8n.flip()}};var Qq=function(P){var K=this;K.$8n=null,K.front=null,K.back=null,K.$4n=[],P&&K.$7n(P)};Qq.prototype={clone:function(){var r=this,x=new Qq;return x.$8n=r.$8n&&r.$8n.clone(),x.front=r.front&&r.front.clone(),x.back=r.back&&r.back.clone(),x.$4n=r.$4n.map(function(h){return h.clone()}),x},$6n:function(){for(var O=this,X=0;X<O.$4n.length;X++)O.$4n[X].flip();O.$8n&&O.$8n.flip(),O.front&&O.front.$6n(),O.back&&O.back.$6n();var v=O.front;O.front=O.back,O.back=v},$1n:function(b){var N=this;if(!N.$8n)return b.slice();for(var x=[],m=[],j=0;j<b.length;j++)N.$8n.$5n(b[j],x,m,x,m);return N.front&&(x=N.front.$1n(x)),m=N.back?N.back.$1n(m):[],x.concat(m)},$3n:function(F){var P=this;P.$4n=F.$1n(P.$4n),P.front&&P.front.$3n(F),P.back&&P.back.$3n(F)},$2n:function(){var v=this,A=v.$4n.slice();return v.front&&(A=A.concat(v.front.$2n())),v.back&&(A=A.concat(v.back.$2n())),A},$7n:function(F){var Y=this;if(F.length){Y.$8n||(Y.$8n=F[0].$8n.clone());for(var c=[],s=[],T=0;T<F.length;T++)this.$8n.$5n(F[T],Y.$4n,Y.$4n,c,s);c.length&&(Y.front||(Y.front=new Qq),this.front.$7n(c)),s.length&&(Y.back||(Y.back=new Qq),Y.back.$7n(s))}}};var mr="symbol",yl=g.Symbol=function(o,V,I){var P=this;H(yl,P),P.s3(20,20,20),P.s({"all.visible":!1,shape:"rect"}),P.setIcon(o,V,I)};Tg("Symbol",s,{setIcon:function(r,U,d){var P,W=this;return yl.superClass.setIcon.call(W,r),r?(P={for3d:!0,face:"center",position:44,names:[r]},d&&(P.transaprent=!0),U&&(P.autorotate=U),W.addStyleIcon(mr,P)):W.removeStyleIcon(mr),W.setWidth(f.getImageWidth(_.getImage(r),W)||20),P}});var oq=g.CSGNode=function(){H(oq,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})},io={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1};Tg("CSGNode",s,{_22Q:function(){return zs},onPropertyChanged:function(_){var O=this,J=O.getHost();oq.superClass.onPropertyChanged.call(O,_),io[_.property]&&(J instanceof Ar||J instanceof oq)&&J.fp("csgNodeChange",!0,!1)}});var zs=function(D,N){H(zs,this,[D,N])};X(zs,B.Node3dUI,{_80o:function(t,n,o){var Y=this;Y._shape3d?zs.superClass._80o.call(Y,t,n,o):(J(Y.gv),yd.forEach(function(J){S(Y,t,n,J,o)}))},validate:function(q,i){var n=this,E=n.gv,$=n.data;if($.s("shape3d"))return zs.superClass.validate.call(n,q,i),n._shape3d=!0,void 0;n._shape3d=!1;var g=u($,E.getMat($));$.appendAnchorMatrix3d(g);var W=q&&q.uv;n.vf2("csg",W);for(var k=0;6>k;k++)for(var j=Ud[k],F=$i[k],Y=n.vf2(j,W,i),r=Y.mat||g,o=Y.vs,p=Y.uv,C=Y.tuv,D=0;2>D;D++){var z=V[F+3*D],Z=V[F+3*D+1],X=V[F+3*D+2];if(P(o,r,[t[3*z],t[3*z+1],t[3*z+2]]),P(o,r,[t[3*Z],t[3*Z+1],t[3*Z+2]]),P(o,r,[t[3*X],t[3*X+1],t[3*X+2]]),C)if(p){var H=8*k;C.push(p[2*z-H],p[2*z+1-H],p[2*Z-H],p[2*Z+1-H],p[2*X-H],p[2*X+1-H])}else C.push(N[2*z],N[2*z+1],N[2*Z],N[2*Z+1],N[2*X],N[2*X+1])}il(n,q,i)},vf2:function(v,i,H){var N,o=this,M=o.gv.getFaceVisible(o.data,v);return N=O(o,v,H),N.vs=[],N.tuv=M&&(N.texture||i)?[]:I,N.visible=M,N}});var Ar=g.CSGShape=function(){var C=this;H(Ar,C),C.s({"shape.background":I,"2d.hostable":!0,"shape.border.width":8}),C.setTall(240),C.setElevation(120),C.setThickness(14)};Tg("CSGShape",a,{IRotatable:!1,_22Q:function(){return Hc},setRotationX:function(){},setRotation:function(){},setRotationZ:function(){},setSegments:function(){}});var Hc=function(e,G){H(Hc,this,[e,G])};X(Hc,B.Shape3dUI,{_80o:function(A,m,t){var f=this;f.undrawable||(J(f.gv),yd.forEach(function(U){S(f,A,m,U,t)}))},validate:function(C,A){var B=this,$=B.data,U=$.getPoints();if(B.undrawable=U.size()<2)return B.clear(),void 0;var j=$.isClosePath(),M=W($._thickness/2,F),d=z(U,I,I,j);yd.forEach(function(R){B.vf(R,C&&C.uv,!0,A)}),j&&(B.left.visible=!1,B.right.visible=!1),B._12O(d,M),B._20Q(d);var G=$.getPointsMatrix3d(),n=g.Math.requestVector3();Ud.forEach(function(M){if(B[M])for(var d=B[M].vs,v=0,_=d.length;_>v;v+=3)n.set(d[v],d[v+1],d[v+2]).applyMatrix4(G),d[v]=n.x,d[v+1]=n.y,d[v+2]=n.z}),g.Math.releaseVector3(n),il(B,C,A)}});var Bk=g.DoorWindow=function(){var W=this;H(Bk,W),W.setElevation(100),W.s3(100,200,14)};Tg("DoorWindow",oq,{IDoorWindow:!0,toggle:function(a){this.setExpanded(!this.s(U),a)},isExpanded:function(){return this.s(U)},setExpanded:function(d,b){var f=this,P=f.$25n,G=f.getDataModel(),r=f.s(U);if(P&&(P.stop(!0),delete f.$25n),r!==d){G&&G.beginTransaction();var u=d?f.s("dw.end"):f.s("dw.start");f.s(U,d),b=e(b),b?(r=f.s(Ah),b.action=function(I){f.s(Ah,r+(u-r)*I)},b.finishFunc=function(){G&&G.endTransaction()},f.$25n=q(b)):(f.s(Ah,u),G&&G.endTransaction())}},getMat:function(){var z=this,V=z.s("dw.s3"),$=z.s("dw.t3"),M=z.s("dw.flip"),X=z.s(Ah);if(V||X||$||M){var c=[];if(M&&c.push({r3:[0,k,0]}),V&&c.push({s3:V}),X){V=z.getFinalScale3d();var t=z.s("dw.axis"),N=V[0]/2,d=V[1]/2;V[2]/2,t===T?c.push({t3:[N,0,0]},{r3:[0,-X,0]},{t3:[-N,0,0]}):t===h?c.push({t3:[-N,0,0]},{r3:[0,X,0]},{t3:[N,0,0]}):t===m?c.push({t3:[0,-d,0]},{r3:[-X,0,0]},{t3:[0,d,0]}):t===j?c.push({t3:[0,d,0]},{r3:[X,0,0]},{t3:[0,-d,0]}):t===D?c.push({r3:[0,X,0]}):t===E&&c.push({r3:[X,0,0]})}return $&&c.push({t3:$}),r(c)}return I}});var Lj=g.CSGBox=function(){var z=this;H(Lj,z),z.setElevation(100),z.s3(100,200,100)};Tg("CSGBox",oq,{ICSGBox:!0,toggleFace:function(A,j){this.setFaceExpanded(A,!this.s(A+b),j)},isFaceExpanded:function(V){return this.s(V+b)},setFaceExpanded:function(E,y,z){var _=this,o=_.$25n,t=_.s(E+b);if(o&&(o.stop(!0),delete _.$25n),t!==y){var s=y?_.s(E+".end"):_.s(E+".start");_.s(E+b,y),z=e(z),z?(t=_.s(E+Hl),z.action=function(c){_.s(E+Hl,t+(s-t)*c)},_.$25n=q(z)):_.s(E+Hl,s)}},getFaceMat:function(j){var P=this,t=P.s(j+Hl);if(!t)return I;var y,H,h,s,z,n,U=P.s(j+".axis"),e=P.getFinalScale3d(),$=P.getAnchor3d(),f=e[0]*$.x,T=e[1]*$.y,d=e[2]*$.z,k=e[0]-f,E=e[1]-T,a=e[2]-d,Y=j+"_"+U;switch(Y){case"front_left":y=-f,H=0,h=a,s=0,z=-t,n=0;break;case"front_right":y=k,H=0,h=a,s=0,z=t,n=0;break;case"front_top":y=0,H=E,h=a,s=-t,z=0,n=0;break;case"front_bottom":y=0,H=-T,h=a,s=t,z=0,n=0;break;case"front_h":y=0,H=0,h=a,s=t,z=0,n=0;break;case"front_v":y=0,H=0,h=a,s=0,z=t,n=0;break;case"back_left":y=k,H=0,h=-d,s=0,z=-t,n=0;break;case"back_right":y=-f,H=0,h=-d,s=0,z=t,n=0;break;case"back_top":y=0,H=E,h=-d,s=t,z=0,n=0;break;case"back_bottom":y=0,H=-T,h=-d,s=-t,z=0,n=0;break;case"back_h":y=0,H=0,h=-d,s=t,z=0,n=0;break;case"back_v":y=0,H=0,h=-d,s=0,z=t,n=0;break;case"left_left":y=-f,H=0,h=-d,s=0,z=-t,n=0;break;case"left_right":y=-f,H=0,h=a,s=0,z=t,n=0;break;case"left_top":y=-f,H=E,h=0,s=0,z=0,n=-t;break;case"left_bottom":y=-f,H=-T,h=0,s=0,z=0,n=t;break;case"left_h":y=-f,H=0,h=0,s=0,z=0,n=t;break;case"left_v":y=-f,H=0,h=0,s=0,z=t,n=0;break;case"right_left":y=k,H=0,h=a,s=0,z=-t,n=0;break;case"right_right":y=k,H=0,h=-d,s=0,z=t,n=0;break;case"right_top":y=k,H=E,h=0,s=0,z=0,n=t;break;case"right_bottom":y=k,H=-T,h=0,s=0,z=0,n=-t;break;case"right_h":y=k,H=0,h=0,s=0,z=0,n=t;break;case"right_v":y=k,H=0,h=0,s=0,z=t,n=0;break;case"top_left":y=-f,H=E,h=0,s=0,z=0,n=t;break;case"top_right":y=k,H=E,h=0,s=0,z=0,n=-t;break;case"top_top":y=0,H=E,h=-d,s=-t,z=0,n=0;break;case"top_bottom":y=0,H=E,h=a,s=t,z=0,n=0;break;case"top_h":y=0,H=E,h=0,s=t,z=0,n=0;break;case"top_v":y=0,H=E,h=0,s=0,z=0,n=t;break;case"bottom_left":y=-f,H=-T,h=0,s=0,z=0,n=-t;break;case"bottom_right":y=k,H=-T,h=0,s=0,z=0,n=t;break;case"bottom_top":y=0,H=-T,h=a,s=-t,z=0,n=0;break;case"bottom_bottom":y=0,H=-T,h=-d,s=t,z=0,n=0;break;case"bottom_h":y=0,H=-T,h=0,s=t,z=0,n=0;break;case"bottom_v":y=0,H=-T,h=0,s=0,z=0,n=t}return r([{t3:[-y,-H,-h]},{r3:[s,z,n]},{t3:[y,H,h]}])}});var Jj=function(D,a,s,K,W){function b(){var j,L=[],z=new y,g=new y;for(P.eachShapeModel(function(D,$,c){for(var C=0,k=$?$.length:D.length/3;k>C;C++)$?(z.fromArray(D,3*$[C]),g.fromArray(c,3*$[C])):(z.fromArray(D,3*C),g.fromArray(c,3*C)),p(L,z,g)}),L=O(L,u.set(1,0,0)),L=O(L,u.set(-1,0,0)),L=O(L,u.set(0,1,0)),L=O(L,u.set(0,-1,0)),L=O(L,u.set(0,0,1)),L=O(L,u.set(0,0,-1)),j=0;j<L.length;j++){var A=L[j];X.push(.5+A.position.x/W.x,.5-A.position.y/W.y),A.position.applyMatrix4(c),i.push(A.position.x,A.position.y,A.position.z),R.push(A.$22n.x,A.$22n.y,A.$22n.z)}}function p(x,z,k){z.applyMatrix4(G),z.applyMatrix4(V),k.transformDirection(G),k.transformDirection(V),x.push(new v(z.clone(),k.clone()))}function O(c,G){for(var T=[],B=.5*Math.abs(W.dot(G)),S=0;S<c.length;S+=3){var M,a,h,Q,K,I,s,$=0,p=c[S+0].position.dot(G)-B,j=c[S+1].position.dot(G)-B,k=c[S+2].position.dot(G)-B;switch(M=p>0,a=j>0,h=k>0,$=(M?1:0)+(a?1:0)+(h?1:0)){case 0:T.push(c[S]),T.push(c[S+1]),T.push(c[S+2]);break;case 1:if(M&&(Q=c[S+1],K=c[S+2],I=e(c[S],Q,G,B),s=e(c[S],K,G,B)),a){Q=c[S],K=c[S+2],I=e(c[S+1],Q,G,B),s=e(c[S+1],K,G,B),T.push(I),T.push(K.clone()),T.push(Q.clone()),T.push(K.clone()),T.push(I.clone()),T.push(s);break}h&&(Q=c[S],K=c[S+1],I=e(c[S+2],Q,G,B),s=e(c[S+2],K,G,B)),T.push(Q.clone()),T.push(K.clone()),T.push(I),T.push(s),T.push(I.clone()),T.push(K.clone());break;case 2:M||(Q=c[S].clone(),K=e(Q,c[S+1],G,B),I=e(Q,c[S+2],G,B),T.push(Q),T.push(K),T.push(I)),a||(Q=c[S+1].clone(),K=e(Q,c[S+2],G,B),I=e(Q,c[S],G,B),T.push(Q),T.push(K),T.push(I)),h||(Q=c[S+2].clone(),K=e(Q,c[S],G,B),I=e(Q,c[S+1],G,B),T.push(Q),T.push(K),T.push(I));break;case 3:}}return T}function e(o,$,P,q){var j=o.position.dot(P)-q,X=$.position.dot(P)-q,T=j/(j-X),k=new v(new y(o.position.x+T*($.position.x-o.position.x),o.position.y+T*($.position.y-o.position.y),o.position.z+T*($.position.z-o.position.z)),new y(o.$22n.x+T*($.$22n.x-o.$22n.x),o.$22n.y+T*($.$22n.y-o.$22n.y),o.$22n.z+T*($.$22n.z-o.$22n.z)));return k}var i=[],R=[],X=[],u=new y,P=D.getData3dUI(a);if(P.mat){var G=(new l).fromArray(P.mat),U=new l;U.makeRotationFromEuler(K),U.setPosition(s);var V=(new l).getInverse(U),c=(new l).scale({x:1/W.x,y:1/W.y,z:1/W.z});return b(),{vs:i,ns:R,uv:X}}};v.prototype.clone=function(){return new v(this.position.clone(),this.$22n.clone())};var Al=function(G,c,U,z){var e=this,M=e.getDataAt(G);if(M){var L=e.intersectObject(G,M);if(L){"object"==typeof c?c=c.x?new y(c.x,c.y,c.z):new y(c[0],c[1],c[2]):(c=c||20,c=new y(c,c,c)),U=U===p?.1:U;var o=new y(e.getUp()),s=new y(e.getCenter()).sub(new y(e.getEye())).normalize(),S="cross",r=s.clone()[S](o).normalize();o.copy(r)[S](s).normalize(),z&&o.applyAxisAngle(L.worldNormal,-z);var k=new g.Node,D=L.worldNormal.clone().setLength(U).add(L.world),K=(new l).lookAt(L.worldNormal.clone(),new y(0,0,0),o),h=(new n).setFromRotationMatrix(K),Z=Jj(e,M,L.world.clone(),h,c);return k.p3(D.x,D.y,D.z),k.setEuler(h),k.s3(c.x,c.y,c.z),k.s({shape3d:Z,"shape3d.reverse.flip":!0}),k}}};x(g.graph3d.Graph3dView,{createDecal:Al})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);